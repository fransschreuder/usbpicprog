MP2COD 4.06.04, COFF to COD File Converter
Copyright (c) 2006 Microchip Technology Inc.
Listing File Generated: Sat Jun 23 12:46:51 2007


Address  Value    Disassembly              Source                                                                           File
-------  -------  -----------------------  -------------------------------------------------------------------------------  -----
                                           /* $Id: c018i.c,v 1.3.14.1 2006/01/24 14:50:12 rhinec Exp $ */                   C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           /* Copyright (c)1999 Microchip Technology */                                     C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           /* MPLAB-C18 startup code, including initialized data */                         C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           /* external reference to the user's main routine */                              C:\MCC18\src\traditional\startup\c018i.c
                                           extern void main (void);                                                         C:\MCC18\src\traditional\startup\c018i.c
                                           /* prototype for the startup function */                                         C:\MCC18\src\traditional\startup\c018i.c
                                           void _entry (void);                                                              C:\MCC18\src\traditional\startup\c018i.c
                                           void _startup (void);                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           /* prototype for the initialized data setup */                                   C:\MCC18\src\traditional\startup\c018i.c
                                           void _do_cinit (void);                                                           C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           extern volatile near unsigned long short TBLPTR;                                 C:\MCC18\src\traditional\startup\c018i.c
                                           extern near unsigned FSR0;                                                       C:\MCC18\src\traditional\startup\c018i.c
                                           extern near char __FPFLAGS;                                                      C:\MCC18\src\traditional\startup\c018i.c
                                           #define RND 6                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           #pragma code _entry_scn=0x000000                                                 C:\MCC18\src\traditional\startup\c018i.c
                                           void                                                                             C:\MCC18\src\traditional\startup\c018i.c
                                           _entry (void)                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                           {                                                                                C:\MCC18\src\traditional\startup\c018i.c
000000   ef65     GOTO      0x6ca          _asm goto _startup _endasm                                                       C:\MCC18\src\traditional\startup\c018i.c
000002   f003                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
000004   0012     RETURN    0x0            }                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                           #pragma code _startup_scn                                                        C:\MCC18\src\traditional\startup\c018i.c
                                           void                                                                             C:\MCC18\src\traditional\startup\c018i.c
                                           _startup (void)                                                                  C:\MCC18\src\traditional\startup\c018i.c
                                           {                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                             _asm                                                                           C:\MCC18\src\traditional\startup\c018i.c
                                               // Initialize the stack pointer                                              C:\MCC18\src\traditional\startup\c018i.c
0006ca   ee13     LFSR      0x1,0x300          lfsr 1, _stack                                                               C:\MCC18\src\traditional\startup\c018i.c
0006cc   f000                                                                                                               
0006ce   ee23     LFSR      0x2,0x300          lfsr 2, _stack                                                               C:\MCC18\src\traditional\startup\c018i.c
0006d0   f000                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
0006d2   6af8     CLRF      0xf8,0x0           clrf TBLPTRU, 0 // 1st silicon doesn't do this on POR                        C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
0006d4   9c16     BCF       0x16,0x6,0x0       bcf __FPFLAGS,RND,0 // Initialize rounding flag for floating point libs      C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                               _endasm                                                                      C:\MCC18\src\traditional\startup\c018i.c
0006d6   eccb     CALL      0x596,0x0          _do_cinit ();                                                                C:\MCC18\src\traditional\startup\c018i.c
0006d8   f002                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           loop:                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                             // Call the user's main routine                                                C:\MCC18\src\traditional\startup\c018i.c
0006da   ec1a     CALL      0x634,0x0        main ();                                                                       C:\MCC18\src\traditional\startup\c018i.c
0006dc   f003                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
0006de   d7fd     BRA       0x6da            goto loop;                                                                     C:\MCC18\src\traditional\startup\c018i.c
0006e0   0012     RETURN    0x0            }                               /* end _startup() */                             C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           /* MPLAB-C18 initialized data memory support */                                  C:\MCC18\src\traditional\startup\c018i.c
                                           /* The linker will populate the _cinit table */                                  C:\MCC18\src\traditional\startup\c018i.c
                                           extern far rom struct                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           {                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                             unsigned short num_init;                                                       C:\MCC18\src\traditional\startup\c018i.c
                                             struct _init_entry                                                             C:\MCC18\src\traditional\startup\c018i.c
                                             {                                                                              C:\MCC18\src\traditional\startup\c018i.c
                                               unsigned long from;                                                          C:\MCC18\src\traditional\startup\c018i.c
                                               unsigned long to;                                                            C:\MCC18\src\traditional\startup\c018i.c
                                               unsigned long size;                                                          C:\MCC18\src\traditional\startup\c018i.c
                                             }                                                                              C:\MCC18\src\traditional\startup\c018i.c
                                             entries[];                                                                     C:\MCC18\src\traditional\startup\c018i.c
                                           }                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                           _cinit;                                                                          C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           #pragma code _cinit_scn                                                          C:\MCC18\src\traditional\startup\c018i.c
                                           void                                                                             C:\MCC18\src\traditional\startup\c018i.c
                                           _do_cinit (void)                                                                 C:\MCC18\src\traditional\startup\c018i.c
                                           {                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                             /* we'll make the assumption in the following code that these statics          C:\MCC18\src\traditional\startup\c018i.c
                                              * will be allocated into the same bank.                                       C:\MCC18\src\traditional\startup\c018i.c
                                              */                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                             static short long prom;                                                        C:\MCC18\src\traditional\startup\c018i.c
                                             static unsigned short curr_byte;                                               C:\MCC18\src\traditional\startup\c018i.c
                                             static unsigned short curr_entry;                                              C:\MCC18\src\traditional\startup\c018i.c
                                             static short long data_ptr;                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                             // Initialized data...                                                         C:\MCC18\src\traditional\startup\c018i.c
000596   0e2a     MOVLW     0x2a             TBLPTR = (short long)&_cinit;                                                  C:\MCC18\src\traditional\startup\c018i.c
000598   6ef6     MOVWF     0xf6,0x0                                                                                        
00059a   0e00     MOVLW     0x0                                                                                             
00059c   6ef7     MOVWF     0xf7,0x0                                                                                        
00059e   0e00     MOVLW     0x0                                                                                             
0005a0   6ef8     MOVWF     0xf8,0x0                                                                                        
                                             _asm                                                                           C:\MCC18\src\traditional\startup\c018i.c
0005a2   0100     MOVLB     0x0                movlb data_ptr                                                               C:\MCC18\src\traditional\startup\c018i.c
0005a4   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\MCC18\src\traditional\startup\c018i.c
0005a6   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\MCC18\src\traditional\startup\c018i.c
0005a8   6f65     MOVWF     0x65,0x1           movwf curr_entry, 1                                                          C:\MCC18\src\traditional\startup\c018i.c
0005aa   0009     TBLRDPOSTINC                 tblrdpostinc                                                                 C:\MCC18\src\traditional\startup\c018i.c
0005ac   50f5     MOVF      0xf5,0x0,0x0       movf TABLAT, 0, 0                                                            C:\MCC18\src\traditional\startup\c018i.c
0005ae   6f66     MOVWF     0x66,0x1           movwf curr_entry+1, 1                                                        C:\MCC18\src\traditional\startup\c018i.c
                                             _endasm                                                                        C:\MCC18\src\traditional\startup\c018i.c
                                               //while (curr_entry)                                                         C:\MCC18\src\traditional\startup\c018i.c
                                               //{                                                                          C:\MCC18\src\traditional\startup\c018i.c
                                               test:                                                                        C:\MCC18\src\traditional\startup\c018i.c
                                               _asm                                                                         C:\MCC18\src\traditional\startup\c018i.c
0005b0   e103     BNZ       0x5b8               bnz 3                                                                       C:\MCC18\src\traditional\startup\c018i.c
0005b2   6765     TSTFSZ    0x65,0x1           tstfsz curr_entry, 1                                                         C:\MCC18\src\traditional\startup\c018i.c
0005b4   d001     BRA       0x5b8              bra 1                                                                        C:\MCC18\src\traditional\startup\c018i.c
                                               _endasm                                                                      C:\MCC18\src\traditional\startup\c018i.c
0005b6   d03d     BRA       0x632              goto done;                                                                   C:\MCC18\src\traditional\startup\c018i.c
                                                 /* Count down so we only have to look up the data in _cinit                C:\MCC18\src\traditional\startup\c018i.c
                                                  * once.                                                                   C:\MCC18\src\traditional\startup\c018i.c
                                                  *                                                                         C:\MCC18\src\traditional\startup\c018i.c
                                                  * At this point we know that TBLPTR points to the top of the current      C:\MCC18\src\traditional\startup\c018i.c
                                                  * entry in _cinit, so we can just start reading the from, to, and         C:\MCC18\src\traditional\startup\c018i.c
                                                  * size values.                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                  */                                                                        C:\MCC18\src\traditional\startup\c018i.c
                                                 _asm                                                                       C:\MCC18\src\traditional\startup\c018i.c
                                           	/* read the source address */                                                   C:\MCC18\src\traditional\startup\c018i.c
0005b8   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005ba   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005bc   6f60     MOVWF     0x60,0x1       	movwf prom, 1                                                                   C:\MCC18\src\traditional\startup\c018i.c
0005be   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005c0   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005c2   6f61     MOVWF     0x61,0x1       	movwf prom+1, 1                                                                 C:\MCC18\src\traditional\startup\c018i.c
0005c4   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005c6   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005c8   6f62     MOVWF     0x62,0x1       	movwf prom+2, 1                                                                 C:\MCC18\src\traditional\startup\c018i.c
                                           	/* skip a byte since it's stored as a 32bit int */                              C:\MCC18\src\traditional\startup\c018i.c
0005ca   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                           	/* read the destination address directly into FSR0 */                           C:\MCC18\src\traditional\startup\c018i.c
0005cc   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005ce   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005d0   6ee9     MOVWF     0xe9,0x0       	movwf FSR0L, 0                                                                  C:\MCC18\src\traditional\startup\c018i.c
0005d2   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005d4   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005d6   6eea     MOVWF     0xea,0x0       	movwf FSR0H, 0                                                                  C:\MCC18\src\traditional\startup\c018i.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\MCC18\src\traditional\startup\c018i.c
0005d8   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005da   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                           	/* read the destination address directly into FSR0 */                           C:\MCC18\src\traditional\startup\c018i.c
0005dc   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005de   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005e0   6f63     MOVWF     0x63,0x1       	movwf curr_byte, 1                                                              C:\MCC18\src\traditional\startup\c018i.c
0005e2   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005e4   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
0005e6   6f64     MOVWF     0x64,0x1       	movwf curr_byte+1, 1                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           	/* skip two bytes since it's stored as a 32bit int */                           C:\MCC18\src\traditional\startup\c018i.c
0005e8   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
0005ea   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                 _endasm                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                 //prom = data_ptr->from;                                                   C:\MCC18\src\traditional\startup\c018i.c
                                                 //FSR0 = data_ptr->to;                                                     C:\MCC18\src\traditional\startup\c018i.c
                                                 //curr_byte = (unsigned short) data_ptr->size;                             C:\MCC18\src\traditional\startup\c018i.c
                                                 /* the table pointer now points to the next entry. Save it                 C:\MCC18\src\traditional\startup\c018i.c
                                                  * off since we'll be using the table pointer to do the copying            C:\MCC18\src\traditional\startup\c018i.c
                                                  * for the entry.                                                          C:\MCC18\src\traditional\startup\c018i.c
                                                  */                                                                        C:\MCC18\src\traditional\startup\c018i.c
0005ec   cff6     MOVFF     0xff6,0x67           data_ptr = TBLPTR;                                                         C:\MCC18\src\traditional\startup\c018i.c
0005ee   f067                                                                                                               
0005f0   cff7     MOVFF     0xff7,0x68                                                                                      
0005f2   f068                                                                                                               
0005f4   cff8     MOVFF     0xff8,0x69                                                                                      
0005f6   f069                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                 /* now assign the source address to the table pointer */                   C:\MCC18\src\traditional\startup\c018i.c
0005f8   c060     MOVFF     0x60,0xff6           TBLPTR = prom;                                                             C:\MCC18\src\traditional\startup\c018i.c
0005fa   fff6                                                                                                               
0005fc   c061     MOVFF     0x61,0xff7                                                                                      
0005fe   fff7                                                                                                               
000600   c062     MOVFF     0x62,0xff8                                                                                      
000602   fff8                                                                                                               
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                 /* do the copy loop */                                                     C:\MCC18\src\traditional\startup\c018i.c
                                                 _asm                                                                       C:\MCC18\src\traditional\startup\c018i.c
                                                   // determine if we have any more bytes to copy                           C:\MCC18\src\traditional\startup\c018i.c
000604   0100     MOVLB     0x0            	movlb curr_byte                                                                 C:\MCC18\src\traditional\startup\c018i.c
000606   5363     MOVF      0x63,0x1,0x1   	movf curr_byte, 1, 1                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           copy_loop:                                                                       C:\MCC18\src\traditional\startup\c018i.c
000608   e102     BNZ       0x60e          	bnz 2 // copy_one_byte                                                          C:\MCC18\src\traditional\startup\c018i.c
00060a   5364     MOVF      0x64,0x1,0x1   	movf curr_byte + 1, 1, 1                                                        C:\MCC18\src\traditional\startup\c018i.c
00060c   e007     BZ        0x61c          	bz 7 // done_copying                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           copy_one_byte:                                                                   C:\MCC18\src\traditional\startup\c018i.c
00060e   0009     TBLRDPOSTINC             	tblrdpostinc                                                                    C:\MCC18\src\traditional\startup\c018i.c
000610   50f5     MOVF      0xf5,0x0,0x0   	movf TABLAT, 0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
000612   6eee     MOVWF     0xee,0x0       	movwf POSTINC0, 0                                                               C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           	// decrement byte counter                                                       C:\MCC18\src\traditional\startup\c018i.c
000614   0763     DECF      0x63,0x1,0x1   	decf curr_byte, 1, 1                                                            C:\MCC18\src\traditional\startup\c018i.c
000616   e2f8     BC        0x608          	bc -8 // copy_loop                                                              C:\MCC18\src\traditional\startup\c018i.c
000618   0764     DECF      0x64,0x1,0x1           decf curr_byte + 1, 1, 1                                                 C:\MCC18\src\traditional\startup\c018i.c
00061a   d7f9     BRA       0x60e          	bra -7 // copy_one_byte                                                         C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           done_copying:                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                                 _endasm                                                                    C:\MCC18\src\traditional\startup\c018i.c
                                                 /* restore the table pointer for the next entry */                         C:\MCC18\src\traditional\startup\c018i.c
00061c   c067     MOVFF     0x67,0xff6           TBLPTR = data_ptr;                                                         C:\MCC18\src\traditional\startup\c018i.c
00061e   fff6                                                                                                               
000620   c068     MOVFF     0x68,0xff7                                                                                      
000622   fff7                                                                                                               
000624   c069     MOVFF     0x69,0xff8                                                                                      
000626   fff8                                                                                                               
                                                 /* next entry... */                                                        C:\MCC18\src\traditional\startup\c018i.c
000628   0100     MOVLB     0x0                  curr_entry--;                                                              C:\MCC18\src\traditional\startup\c018i.c
00062a   0765     DECF      0x65,0x1,0x1                                                                                    
00062c   0e00     MOVLW     0x0                                                                                             
00062e   5b66     SUBWFB    0x66,0x1,0x1                                                                                    
000630   d7bf     BRA       0x5b0                goto test;                                                                 C:\MCC18\src\traditional\startup\c018i.c
                                           done:                                                                            C:\MCC18\src\traditional\startup\c018i.c
                                           ;                                                                                C:\MCC18\src\traditional\startup\c018i.c
000632   0012     RETURN    0x0            }                                                                                C:\MCC18\src\traditional\startup\c018i.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            *                Microchip USB Bootloader Version 1.0                           G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\main.c
                                            * FileName:        main.c                                                       G:\USBPICPROG-SVN\Boot\main.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\main.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\main.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\main.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\main.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\main.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\main.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\main.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\main.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\main.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\main.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\main.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\main.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\main.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\main.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\main.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\main.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\main.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\main.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\main.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   G:\USBPICPROG-SVN\Boot\main.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                           #include <p18cxxx.h>                                                             G:\USBPICPROG-SVN\Boot\main.c
                                           #include "sys\typedefs.h"                        // Required                     G:\USBPICPROG-SVN\Boot\main.c
                                           #include "sys\usb.h"                         // Required                         G:\USBPICPROG-SVN\Boot\main.c
                                           #include "io_cfg.h"                                 // Required                  G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           #include "sys\usb_compile_time_validation.h" // Optional                         G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** V A R I A B L E S ********************************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** V E C T O R  R E M A P P I N G *******************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma code _HIGH_INTERRUPT_VECTOR = 0x000008                                   G:\USBPICPROG-SVN\Boot\main.c
                                           void _high_ISR (void)                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\main.c
000008   ef04     GOTO      0x808              _asm goto RM_HIGH_INTERRUPT_VECTOR _endasm                                   G:\USBPICPROG-SVN\Boot\main.c
00000a   f004                                                                                                               
00000c   0012     RETURN    0x0            }                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma code _LOW_INTERRUPT_VECTOR = 0x000018                                    G:\USBPICPROG-SVN\Boot\main.c
                                           void _low_ISR (void)                                                             G:\USBPICPROG-SVN\Boot\main.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\main.c
000018   ef0c     GOTO      0x818              _asm goto RM_LOW_INTERRUPT_VECTOR _endasm                                    G:\USBPICPROG-SVN\Boot\main.c
00001a   f004                                                                                                               
00001c   0012     RETURN    0x0            }                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** D E C L A R A T I O N S **************************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\main.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\main.c
                                            * Function:        void main(void)                                              G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Overview:        Main program entry point.                                    G:\USBPICPROG-SVN\Boot\main.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\main.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                           void main(void)                                                                  G:\USBPICPROG-SVN\Boot\main.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                           	static byte i;                                                                  G:\USBPICPROG-SVN\Boot\main.c
                                           	                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                           	// initial settings                                                             G:\USBPICPROG-SVN\Boot\main.c
000634   6892     SETF      0x92,0x0       	TRISA = 0xFF;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000636   6893     SETF      0x93,0x0       	TRISB = 0xFF;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000638   0ef8     MOVLW     0xf8           	TRISC = 0xF8;                                                                   G:\USBPICPROG-SVN\Boot\main.c
00063a   6e94     MOVWF     0x94,0x0                                                                                        
00063c   6a80     CLRF      0x80,0x0       	PORTA = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
00063e   0e04     MOVLW     0x4            	PORTB = 0x04;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000640   6e81     MOVWF     0x81,0x0                                                                                        
000642   6a82     CLRF      0x82,0x0       	PORTC = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000644   6ad5     CLRF      0xd5,0x0       	T0CON = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000646   6acd     CLRF      0xcd,0x0       	T1CON = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000648   6aca     CLRF      0xca,0x0       	T2CON = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
00064a   6ab1     CLRF      0xb1,0x0       	T3CON = 0x00;                                                                   G:\USBPICPROG-SVN\Boot\main.c
00064c   0e07     MOVLW     0x7            	CMCON = 0x07;                                                                   G:\USBPICPROG-SVN\Boot\main.c
00064e   6eb4     MOVWF     0xb4,0x0                                                                                        
000650   6abd     CLRF      0xbd,0x0       	CCP1CON = 0x00;                                                                 G:\USBPICPROG-SVN\Boot\main.c
000652   6aba     CLRF      0xba,0x0       	CCP2CON = 0x00;                                                                 G:\USBPICPROG-SVN\Boot\main.c
000654   6af1     CLRF      0xf1,0x0       	INTCON2 = 0x00;                                                                 G:\USBPICPROG-SVN\Boot\main.c
                                           	                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                               // initialize usb                                                            G:\USBPICPROG-SVN\Boot\main.c
000656   0e14     MOVLW     0x14               mInitializeUSBDriver();     // See usbdrv.h                                  G:\USBPICPROG-SVN\Boot\main.c
000658   6e6f     MOVWF     0x6f,0x0                                                                                        
00065a   ec7a     CALL      0x4f4,0x0          USBCheckBusStatus();        // Modified to always enable USB module          G:\USBPICPROG-SVN\Boot\main.c
00065c   f002                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
00065e   8082     BSF       0x82,0x0,0x0       LED_0 = 1;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000660   8282     BSF       0x82,0x1,0x0       LED_1 = 1;                                                                   G:\USBPICPROG-SVN\Boot\main.c
000662   8482     BSF       0x82,0x2,0x0       LED_2 = 1;                                                                   G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
000664   ac81     BTFSS     0x81,0x6,0x0       if (PORTBbits.RB6)                                                           G:\USBPICPROG-SVN\Boot\main.c
000666   d002     BRA       0x66c                                                                                           
                                           	{                                                                               G:\USBPICPROG-SVN\Boot\main.c
000668   ef00     GOTO      0x800          		_asm goto RM_RESET_VECTOR _endasm                                              G:\USBPICPROG-SVN\Boot\main.c
00066a   f004                                                                                                               
                                           	}                                                                               G:\USBPICPROG-SVN\Boot\main.c
                                           	                                                                                G:\USBPICPROG-SVN\Boot\main.c
                                           	// led 0 on                                                                     G:\USBPICPROG-SVN\Boot\main.c
00066c   9082     BCF       0x82,0x0,0x0       LED_0 = 0;                                                                   G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                               // init i and j                                                              G:\USBPICPROG-SVN\Boot\main.c
00066e   6a17     CLRF      0x17,0x0           i = DETACHED_STATE;                                                          G:\USBPICPROG-SVN\Boot\main.c
000690   d7ef     BRA       0x670              while(1)                                                                     G:\USBPICPROG-SVN\Boot\main.c
                                               {                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           	    // do usb things                                                            G:\USBPICPROG-SVN\Boot\main.c
000670   ec84     CALL      0x508,0x0              USBDriverService();     // See usbdrv.c                                  G:\USBPICPROG-SVN\Boot\main.c
000672   f002                                                                                                               
000674   ec98     CALL      0x130,0x0              BootService();          // See boot.c                                    G:\USBPICPROG-SVN\Boot\main.c
000676   f000                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                                   // set i to current usb_device state                                     G:\USBPICPROG-SVN\Boot\main.c
000678   5017     MOVF      0x17,0x0,0x0           if (usb_device_state != i && i != CONFIGURED_STATE)                      G:\USBPICPROG-SVN\Boot\main.c
00067a   5c0d     SUBWF     0xd,0x0,0x0                                                                                     
00067c   e009     BZ        0x690                                                                                           
00067e   0e06     MOVLW     0x6                                                                                             
000680   5c17     SUBWF     0x17,0x0,0x0                                                                                    
000682   e006     BZ        0x690                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\main.c
000684   500d     MOVF      0xd,0x0,0x0    	    	i = usb_device_state;                                                      G:\USBPICPROG-SVN\Boot\main.c
000686   6e17     MOVWF     0x17,0x0                                                                                        
                                           	    	                                                                           G:\USBPICPROG-SVN\Boot\main.c
000688   0e06     MOVLW     0x6            	    	if (usb_device_state == CONFIGURED_STATE)                                  G:\USBPICPROG-SVN\Boot\main.c
00068a   5c0d     SUBWF     0xd,0x0,0x0                                                                                     
00068c   e101     BNZ       0x690                                                                                           
                                           	    	{                                                                          G:\USBPICPROG-SVN\Boot\main.c
                                           		    	// set led 1 when connected to usb                                        G:\USBPICPROG-SVN\Boot\main.c
00068e   9282     BCF       0x82,0x1,0x0   		    	LED_1 = 0;                                                                G:\USBPICPROG-SVN\Boot\main.c
                                           		    }                                                                          G:\USBPICPROG-SVN\Boot\main.c
                                           	    }                                                                           G:\USBPICPROG-SVN\Boot\main.c
                                               }//end while                                                                 G:\USBPICPROG-SVN\Boot\main.c
000692   0012     RETURN    0x0            }//end main                                                                      G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           #pragma code user = RM_RESET_VECTOR                                              G:\USBPICPROG-SVN\Boot\main.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\main.c
                                           /** EOF main.c ***************************************************************/  G:\USBPICPROG-SVN\Boot\main.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *      Microchip USB C18 Firmware -  USB Bootloader Version 1.00                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * FileName:        boot.c                                                       G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Rawin Rojvanit       11/19/04    Original. USB Bootloader                     G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * -boot.c-                                                                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * This file contains functions necessary to carry out bootloading tasks.        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * The only 2 USB specific functions are BootInitEP() and BootService().         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * All other functions can be reused with other communication methods.           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #include <p18cxxx.h>                                                             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #include "io_cfg.h"                                                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           // 8 MHz Resonator/Quarz                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** Configuration ********************************************************/      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config PLLDIV = 2, CPUDIV = OSC1_PLL2, USBDIV = 2, FOSC = HSPLL_HS //CPU=48 MHz G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config PWRT = ON                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config BOR = OFF                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config VREGEN = ON 	// USB Voltage Regulator Enable: ein                 G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config WDT = OFF 	// Watchdog Timer: aus                                 G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config MCLRE = ON // MCLR Enable:                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           //#pragma config MCLRE = OFF 	// MCLR Disabled    RE3 enabled                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config PBADEN = OFF // PORTB<4:0> pins are configured as digital I/O on Reset G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config LVP = OFF 	// Low Voltage ICSP: aus                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config CPB = ON		// boot block code protection: on                       G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config WRTB = ON	// boot block write protection: on                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config CCP2MX = OFF                                                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma config STVREN = OFF                                                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** V A R I A B L E S ********************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           byte counter;                                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           byte byteTemp;                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           byte trf_state;                                                                  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           word big_counter;                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** D E C L A R A T I O N S **************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** C L A S S  S P E C I F I C  R E Q ****************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** U S E R  A P I ***********************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Function:        void BootInitEP(void)                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Overview:        BootInitEP initializes bootloader endpoints, buffer          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                  descriptors, internal state-machine, and variables.          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                  It should be called after the USB host has sent out a        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                  SET_CONFIGURATION request.                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                  See USBStdSetCfgHandler() in usb9.c for examples.            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void BootInitEP(void)                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
00002c   6a0a     CLRF      0xa,0x0            trf_state = WAIT_FOR_CMD;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
00002e   0e1e     MOVLW     0x1e               BOOT_UEP = EP_OUT_IN|HSHK_EN;               // Enable 2 data pipes           G:\USBPICPROG-SVN\Boot\sys\boot.c
000030   6e71     MOVWF     0x71,0x0                                                                                        
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * Do not have to init Cnt of IN pipes here.                                 G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * Reason:  Number of bytes to send to the host                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          varies from one transaction to                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          another. Cnt should equal the exact                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          number of bytes to transmit for                                  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          a given IN transaction.                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          This number of bytes will only                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          be known right before the data is                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                *          sent.                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
000032   0104     MOVLB     0x4                BOOT_BD_OUT.Cnt = sizeof(dataPacket);   // Set buffer size                   G:\USBPICPROG-SVN\Boot\sys\boot.c
000034   0e40     MOVLW     0x40                                                                                            
000036   6f09     MOVWF     0x9,0x1                                                                                         
000038   0e20     MOVLW     0x20               BOOT_BD_OUT.ADR = (byte*)&dataPacket;   // Set buffer address                G:\USBPICPROG-SVN\Boot\sys\boot.c
00003a   6f0a     MOVWF     0xa,0x1                                                                                         
00003c   0e04     MOVLW     0x4                                                                                             
00003e   6f0b     MOVWF     0xb,0x1                                                                                         
000040   0e88     MOVLW     0x88               BOOT_BD_OUT.Stat._byte = _USIE|_DAT0|_DTSEN;// Set status                    G:\USBPICPROG-SVN\Boot\sys\boot.c
000042   6f08     MOVWF     0x8,0x1                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000044   0104     MOVLB     0x4                BOOT_BD_IN.ADR = (byte*)&dataPacket;    // Set buffer address                G:\USBPICPROG-SVN\Boot\sys\boot.c
000046   0e20     MOVLW     0x20                                                                                            
000048   6f0e     MOVWF     0xe,0x1                                                                                         
00004a   0e04     MOVLW     0x4                                                                                             
00004c   6f0f     MOVWF     0xf,0x1                                                                                         
00004e   0e40     MOVLW     0x40               BOOT_BD_IN.Stat._byte = _UCPU|_DAT1;    // Set buffer status                 G:\USBPICPROG-SVN\Boot\sys\boot.c
000050   6f0c     MOVWF     0xc,0x1                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000052   0012     RETURN    0x0            }//end BootInitEP                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void StartWrite(void)                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * A write command can be prematurely terminated by MCLR or WDT reset        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
000054   0e55     MOVLW     0x55               EECON2 = 0x55;                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
000056   6ea7     MOVWF     0xa7,0x0                                                                                        
000058   0eaa     MOVLW     0xaa               EECON2 = 0xAA;                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
00005a   6ea7     MOVWF     0xa7,0x0                                                                                        
00005c   82a6     BSF       0xa6,0x1,0x0       EECON1_WR = 1;                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
00005e   0012     RETURN    0x0            }//end StartWrite                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void ReadVersion(void) //TESTED: Passed                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
000060   0104     MOVLB     0x4                dataPacket._byte[2] = MINOR_VERSION; 	// 0x00 = Bootloader Version 0         G:\USBPICPROG-SVN\Boot\sys\boot.c
000062   6b22     CLRF      0x22,0x1                                                                                        
000064   0e01     MOVLW     0x1                dataPacket._byte[3] = MAJOR_VERSION;	// 0x01 = Bootloader                    G:\USBPICPROG-SVN\Boot\sys\boot.c
000066   6f23     MOVWF     0x23,0x1                                                                                        
000068   0012     RETURN    0x0            }//end ReadVersion                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void ReadProgMem(void) //TESTED: Passed                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
00006a   6a08     CLRF      0x8,0x0            for (counter = 0; counter < dataPacket.len; counter++)                       G:\USBPICPROG-SVN\Boot\sys\boot.c
00006c   d8df     RCALL     0x22c                                                                                           
00006e   e209     BC        0x82                                                                                            
00007e   2a08     INCF      0x8,0x1,0x0                                                                                     
000080   d7f5     BRA       0x6c                                                                                            
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                   //2 separate inst prevents compiler from using RAM stack                 G:\USBPICPROG-SVN\Boot\sys\boot.c
000070   d8eb     RCALL     0x248                  byteTemp = *((dataPacket.ADR.pAdr)+counter);                             G:\USBPICPROG-SVN\Boot\sys\boot.c
000072   0008     TBLRD                                                                                                     
000074   50f5     MOVF      0xf5,0x0,0x0                                                                                    
000076   6e09     MOVWF     0x9,0x0                                                                                         
000248   6a12     CLRF      0x12,0x0                                                                                        
00024a   6a13     CLRF      0x13,0x0                                                                                        
00024c   5122     MOVF      0x22,0x0,0x1                                                                                    
00024e   2408     ADDWF     0x8,0x0,0x0                                                                                     
000250   ef03     GOTO      0x206                                                                                           
000252   f001                                                                                                               
000078   d8d2     RCALL     0x21e                  dataPacket.data[counter] = byteTemp;                                     G:\USBPICPROG-SVN\Boot\sys\boot.c
00007a   c009     MOVFF     0x9,0xfef                                                                                       
00007c   ffef                                                                                                               
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000082   6af8     CLRF      0xf8,0x0           TBLPTRU = 0x00;         // forces upper byte back to 0x00                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                       // optional fix is to set large code model           G:\USBPICPROG-SVN\Boot\sys\boot.c
000084   0012     RETURN    0x0            }//end ReadProgMem                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void WriteProgMem(void) //TESTED: Passed                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * The write holding register for the 18F4550 family is                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * actually 32-byte. The code below only tries to write                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * 16-byte because the GUI program only sends out 16-byte                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * at a time.                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                * This limitation will be fixed in the future version.                      G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
000086   0ef0     MOVLW     0xf0               dataPacket.ADR.low &= 0b11110000;  //Force 16-byte boundary                  G:\USBPICPROG-SVN\Boot\sys\boot.c
000088   0104     MOVLB     0x4                                                                                             
00008a   1722     ANDWF     0x22,0x1,0x1                                                                                    
00008c   0e84     MOVLW     0x84               EECON1 = 0b10000100;        //Setup writes: EEPGD=1,WREN=1                   G:\USBPICPROG-SVN\Boot\sys\boot.c
00008e   6ea6     MOVWF     0xa6,0x0                                                                                        
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               //LEN = # of byte to write                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000090   6a08     CLRF      0x8,0x0            for (counter = 0; counter < (dataPacket.len); counter++)                     G:\USBPICPROG-SVN\Boot\sys\boot.c
000092   d8cc     RCALL     0x22c                                                                                           
000094   e208     BC        0xa6                                                                                            
0000a2   2a08     INCF      0x8,0x1,0x0                                                                                     
0000a4   d7f6     BRA       0x92                                                                                            
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000096   d8ce     RCALL     0x234                  *((dataPacket.ADR.pAdr)+counter) = \                                     G:\USBPICPROG-SVN\Boot\sys\boot.c
000234   dff4     RCALL     0x21e                                                                                           
000236   cfef     MOVFF     0xfef,0x14                                                                                      
000238   f014                                                                                                               
00023a   5008     MOVF      0x8,0x0,0x0                                                                                     
00023c   6e11     MOVWF     0x11,0x0                                                                                        
00023e   d804     RCALL     0x248                                                                                           
000240   c014     MOVFF     0x14,0xff5                                                                                      
000242   fff5                                                                                                               
000244   000c     TBLWT                                                                                                     
000246   0012     RETURN    0x0                                                                                             
                                                   dataPacket.data[counter];                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
000098   0e0f     MOVLW     0xf                    if ((counter & 0b00001111) == 0b00001111)                                G:\USBPICPROG-SVN\Boot\sys\boot.c
00009a   1408     ANDWF     0x8,0x0,0x0                                                                                     
00009c   080f     SUBLW     0xf                                                                                             
00009e   e101     BNZ       0xa2                                                                                            
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
0000a0   dfd9     RCALL     0x54                       StartWrite();                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                   }//end if                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0000a6   0012     RETURN    0x0            }//end WriteProgMem                                                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void EraseProgMem(void) //TESTED: Passed                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               //The most significant 16 bits of the address pointer points to the block    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               //being erased. Bits5:0 are ignored. (In hardware).                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               //LEN = # of 64-byte block to erase                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
0000a8   0e94     MOVLW     0x94               EECON1 = 0b10010100;     //Setup writes: EEPGD=1,FREE=1,WREN=1               G:\USBPICPROG-SVN\Boot\sys\boot.c
0000aa   6ea6     MOVWF     0xa6,0x0                                                                                        
0000ac   6a08     CLRF      0x8,0x0            for(counter=0; counter < dataPacket.len; counter++)                          G:\USBPICPROG-SVN\Boot\sys\boot.c
0000ae   d8be     RCALL     0x22c                                                                                           
0000b0   e213     BC        0xd8                                                                                            
0000d4   2a08     INCF      0x8,0x1,0x0                                                                                     
0000d6   d7eb     BRA       0xae                                                                                            
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0000b2   5008     MOVF      0x8,0x0,0x0            *(dataPacket.ADR.pAdr+(((int)counter) << 6));  //Load TBLPTR             G:\USBPICPROG-SVN\Boot\sys\boot.c
0000b4   6e11     MOVWF     0x11,0x0                                                                                        
0000b6   6a12     CLRF      0x12,0x0                                                                                        
0000b8   0e06     MOVLW     0x6                                                                                             
0000ba   90d8     BCF       0xd8,0x0,0x0                                                                                    
0000bc   3611     RLCF      0x11,0x1,0x0                                                                                    
0000be   3612     RLCF      0x12,0x1,0x0                                                                                    
0000c0   04e8     DECF      0xe8,0x0,0x0                                                                                    
0000c2   e1fb     BNZ       0xba                                                                                            
0000c4   6a13     CLRF      0x13,0x0                                                                                        
0000c6   be12     BTFSC     0x12,0x7,0x0                                                                                    
0000c8   6813     SETF      0x13,0x0                                                                                        
0000ca   0104     MOVLB     0x4                                                                                             
0000cc   5122     MOVF      0x22,0x0,0x1                                                                                    
0000ce   2411     ADDWF     0x11,0x0,0x0                                                                                    
0000d0   d89a     RCALL     0x206                                                                                           
0000d2   dfc0     RCALL     0x54                   StartWrite();                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0000d8   6af8     CLRF      0xf8,0x0           TBLPTRU = 0;            // forces upper byte back to 0x00                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                       // optional fix is to set large code model           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                       // (for USER ID 0x20 0x00 0x00)                      G:\USBPICPROG-SVN\Boot\sys\boot.c
0000da   0012     RETURN    0x0            }//end EraseProgMem                                                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void ReadEE(void) //TESTED: Passed                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
0000dc   6aa6     CLRF      0xa6,0x0           EECON1 = 0x00;                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
0000de   6a08     CLRF      0x8,0x0            for(counter=0; counter < dataPacket.len; counter++)                          G:\USBPICPROG-SVN\Boot\sys\boot.c
0000e0   d8a5     RCALL     0x22c                                                                                           
0000e2   e209     BC        0xf6                                                                                            
0000f2   2a08     INCF      0x8,0x1,0x0                                                                                     
0000f4   d7f5     BRA       0xe0                                                                                            
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0000e4   5122     MOVF      0x22,0x0,0x1           EEADR = (byte)dataPacket.ADR.pAdr + counter;                             G:\USBPICPROG-SVN\Boot\sys\boot.c
0000e6   2408     ADDWF     0x8,0x0,0x0                                                                                     
0000e8   6ea9     MOVWF     0xa9,0x0                                                                                        
                                                   //EEADRH = (BYTE)(((int)dataPacket.FIELD.ADDR.POINTER + counter) >> 8);  G:\USBPICPROG-SVN\Boot\sys\boot.c
0000ea   80a6     BSF       0xa6,0x0,0x0           EECON1_RD = 1;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
0000ec   d898     RCALL     0x21e                  dataPacket.data[counter] = EEDATA;                                       G:\USBPICPROG-SVN\Boot\sys\boot.c
0000ee   cfa8     MOVFF     0xfa8,0xfef                                                                                     
0000f0   ffef                                                                                                               
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0000f6   0012     RETURN    0x0            }//end ReadEE                                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void WriteEE(void) //TESTED: Passed                                              G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
0000f8   6a08     CLRF      0x8,0x0            for(counter=0; counter < dataPacket.len; counter++)                          G:\USBPICPROG-SVN\Boot\sys\boot.c
0000fa   d898     RCALL     0x22c                                                                                           
0000fc   e20d     BC        0x118                                                                                           
000114   2a08     INCF      0x8,0x1,0x0                                                                                     
000116   d7f1     BRA       0xfa                                                                                            
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0000fe   5122     MOVF      0x22,0x0,0x1           EEADR = (byte)dataPacket.ADR.pAdr + counter;                             G:\USBPICPROG-SVN\Boot\sys\boot.c
000100   2408     ADDWF     0x8,0x0,0x0                                                                                     
000102   6ea9     MOVWF     0xa9,0x0                                                                                        
                                                   //EEADRH = (BYTE)(((int)dataPacket.FIELD.ADDR.POINTER + counter) >> 8);  G:\USBPICPROG-SVN\Boot\sys\boot.c
000104   d88c     RCALL     0x21e                  EEDATA = dataPacket.data[counter];                                       G:\USBPICPROG-SVN\Boot\sys\boot.c
000106   50ef     MOVF      0xef,0x0,0x0                                                                                    
000108   6ea8     MOVWF     0xa8,0x0                                                                                        
00010a   0e04     MOVLW     0x4                    EECON1 = 0b00000100;    //Setup writes: EEPGD=0,WREN=1                   G:\USBPICPROG-SVN\Boot\sys\boot.c
00010c   6ea6     MOVWF     0xa6,0x0                                                                                        
00010e   dfa2     RCALL     0x54                   StartWrite();                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000110   b2a6     BTFSC     0xa6,0x1,0x0           while(EECON1_WR);       //Wait till WR bit is clear                      G:\USBPICPROG-SVN\Boot\sys\boot.c
000112   d7fe     BRA       0x110                                                                                           
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
000118   0012     RETURN    0x0            }//end WriteEE                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           //WriteConfig is different from WriteProgMem b/c it can write a byte             G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void WriteConfig(void) //TESTED: Passed                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
00011a   0ec4     MOVLW     0xc4               EECON1 = 0b11000100;        //Setup writes: EEPGD=1,CFGS=1,WREN=1            G:\USBPICPROG-SVN\Boot\sys\boot.c
00011c   6ea6     MOVWF     0xa6,0x0                                                                                        
00011e   6a08     CLRF      0x8,0x0            for (counter = 0; counter < dataPacket.len; counter++)                       G:\USBPICPROG-SVN\Boot\sys\boot.c
000120   d885     RCALL     0x22c                                                                                           
000122   e204     BC        0x12c                                                                                           
000128   2a08     INCF      0x8,0x1,0x0                                                                                     
00012a   d7fa     BRA       0x120                                                                                           
00022c   0104     MOVLB     0x4                                                                                             
00022e   5121     MOVF      0x21,0x0,0x1                                                                                    
000230   5c08     SUBWF     0x8,0x0,0x0                                                                                     
000232   0012     RETURN    0x0                                                                                             
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000124   d887     RCALL     0x234                  *((dataPacket.ADR.pAdr)+counter) = dataPacket.data[counter];             G:\USBPICPROG-SVN\Boot\sys\boot.c
000206   6ef3     MOVWF     0xf3,0x0                                                                                        
000208   5123     MOVF      0x23,0x0,0x1                                                                                    
00020a   2012     ADDWFC    0x12,0x0,0x0                                                                                    
00020c   6ef4     MOVWF     0xf4,0x0                                                                                        
00020e   5124     MOVF      0x24,0x0,0x1                                                                                    
000210   2013     ADDWFC    0x13,0x0,0x0                                                                                    
000212   6ef8     MOVWF     0xf8,0x0                                                                                        
000214   cff4     MOVFF     0xff4,0xff7                                                                                     
000216   fff7                                                                                                               
000218   cff3     MOVFF     0xff3,0xff6                                                                                     
00021a   fff6                                                                                                               
00021c   0012     RETURN    0x0                                                                                             
00021e   5008     MOVF      0x8,0x0,0x0                                                                                     
000220   6aea     CLRF      0xea,0x0                                                                                        
000222   0f25     ADDLW     0x25                                                                                            
000224   6ee9     MOVWF     0xe9,0x0                                                                                        
000226   0e04     MOVLW     0x4                                                                                             
000228   22ea     ADDWFC    0xea,0x1,0x0                                                                                    
00022a   0012     RETURN    0x0                                                                                             
000126   df96     RCALL     0x54                   StartWrite();                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               }//end for                                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
00012c   6af8     CLRF      0xf8,0x0           TBLPTRU = 0x00;         // forces upper byte back to 0x00                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                       // optional fix is to set large code model           G:\USBPICPROG-SVN\Boot\sys\boot.c
00012e   0012     RETURN    0x0            }//end WriteConfig                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           void BootService(void)                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
000130   0e06     MOVLW     0x6                if((usb_device_state < CONFIGURED_STATE)||(UCONbits.SUSPND==1)) return;      G:\USBPICPROG-SVN\Boot\sys\boot.c
000132   5c0d     SUBWF     0xd,0x0,0x0                                                                                     
000134   e303     BNC       0x13c                                                                                           
000136   506d     MOVF      0x6d,0x0,0x0                                                                                    
000138   0b02     ANDLW     0x2                                                                                             
00013a   e001     BZ        0x13e                                                                                           
00013c   d063     BRA       0x204                                                                                           
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
00013e   040a     DECF      0xa,0x0,0x0        if(trf_state == SENDING_RESP)                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
000140   e110     BNZ       0x162                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000142   0104     MOVLB     0x4                    if(!mBootTxIsBusy())                                                     G:\USBPICPROG-SVN\Boot\sys\boot.c
000144   bf0c     BTFSC     0xc,0x7,0x1                                                                                     
000146   d00c     BRA       0x160                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
000148   0104     MOVLB     0x4                        BOOT_BD_OUT.Cnt = sizeof(dataPacket);                                G:\USBPICPROG-SVN\Boot\sys\boot.c
00014a   0e40     MOVLW     0x40                                                                                            
00014c   6f09     MOVWF     0x9,0x1                                                                                         
00014e   0e40     MOVLW     0x40                       mUSBBufferReady(BOOT_BD_OUT);                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
000150   0104     MOVLB     0x4                                                                                             
000152   1708     ANDWF     0x8,0x1,0x1                                                                                     
000154   0104     MOVLB     0x4                                                                                             
000156   7d08     BTG       0x8,0x6,0x1                                                                                     
000158   0e88     MOVLW     0x88                                                                                            
00015a   0104     MOVLB     0x4                                                                                             
00015c   1308     IORWF     0x8,0x1,0x1                                                                                     
00015e   6a0a     CLRF      0xa,0x0                    trf_state = WAIT_FOR_CMD;                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                   }//end if                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
000160   d051     BRA       0x204                  return;                                                                  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               }//end if                                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000162   0104     MOVLB     0x4                if(!mBootRxIsBusy())                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
000164   bf08     BTFSC     0x8,0x7,0x1                                                                                     
000166   d04e     BRA       0x204                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
000168   6a08     CLRF      0x8,0x0                counter = 0;                                                             G:\USBPICPROG-SVN\Boot\sys\boot.c
00016a   0104     MOVLB     0x4                    switch(dataPacket.CMD)                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
00016c   5120     MOVF      0x20,0x0,0x1                                                                                    
00016e   0aff     XORLW     0xff                                                                                            
000170   e02e     BZ        0x1ce                                                                                           
000172   0af8     XORLW     0xf8                                                                                            
000174   e028     BZ        0x1c6                                                                                           
000176   0a02     XORLW     0x2                                                                                             
000178   e022     BZ        0x1be                                                                                           
00017a   0a01     XORLW     0x1                                                                                             
00017c   e01c     BZ        0x1b6                                                                                           
00017e   0a07     XORLW     0x7                                                                                             
000180   e016     BZ        0x1ae                                                                                           
000182   0a01     XORLW     0x1                                                                                             
000184   e010     BZ        0x1a6                                                                                           
000186   0a03     XORLW     0x3                                                                                             
000188   e00a     BZ        0x19e                                                                                           
00018a   0a07     XORLW     0x7                                                                                             
00018c   e008     BZ        0x19e                                                                                           
00018e   0a06     XORLW     0x6                                                                                             
000190   e001     BZ        0x194                                                                                           
000192   d029     BRA       0x1e6                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case READ_VERSION:                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
000194   df65     RCALL     0x60                           ReadVersion();                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
000196   9482     BCF       0x82,0x2,0x0                   LED_2 = 0;                                                       G:\USBPICPROG-SVN\Boot\sys\boot.c
000198   0e04     MOVLW     0x4                            counter=0x04;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
00019a   6e08     MOVWF     0x8,0x0                                                                                         
00019c   d025     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case READ_FLASH:                                                     G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case READ_CONFIG:                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
00019e   df65     RCALL     0x6a                           ReadProgMem();                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001a0   0e05     MOVLW     0x5                            counter+=0x05;                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001a2   2608     ADDWF     0x8,0x1,0x0                                                                                     
0001a4   d021     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case WRITE_FLASH:                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001a6   df6f     RCALL     0x86                           WriteProgMem();                                                  G:\USBPICPROG-SVN\Boot\sys\boot.c
0001a8   0e01     MOVLW     0x1                            counter=0x01;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001aa   6e08     MOVWF     0x8,0x0                                                                                         
0001ac   d01d     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case ERASE_FLASH:                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ae   df7c     RCALL     0xa8                           EraseProgMem();                                                  G:\USBPICPROG-SVN\Boot\sys\boot.c
0001b0   0e01     MOVLW     0x1                            counter=0x01;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001b2   6e08     MOVWF     0x8,0x0                                                                                         
0001b4   d019     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case READ_EEDATA:                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001b6   df92     RCALL     0xdc                           ReadEE();                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
0001b8   0e05     MOVLW     0x5                            counter+=0x05;                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ba   2608     ADDWF     0x8,0x1,0x0                                                                                     
0001bc   d015     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case WRITE_EEDATA:                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001be   df9c     RCALL     0xf8                           WriteEE();                                                       G:\USBPICPROG-SVN\Boot\sys\boot.c
0001c0   0e01     MOVLW     0x1                            counter=0x01;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001c2   6e08     MOVWF     0x8,0x0                                                                                         
0001c4   d011     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case WRITE_CONFIG:                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001c6   dfa9     RCALL     0x11a                          WriteConfig();                                                   G:\USBPICPROG-SVN\Boot\sys\boot.c
0001c8   0e01     MOVLW     0x1                            counter=0x01;                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ca   6e08     MOVWF     0x8,0x0                                                                                         
0001cc   d00d     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       case RESET:                                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                           //When resetting, make sure to drop the device off the bus       G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                           //for a period of time. Helps when the device is suspended.      G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ce   966d     BCF       0x6d,0x3,0x0                   UCONbits.USBEN = 0;                                              G:\USBPICPROG-SVN\Boot\sys\boot.c
0001d0   6a0b     CLRF      0xb,0x0                        big_counter = 0;                                                 G:\USBPICPROG-SVN\Boot\sys\boot.c
0001d2   6a0c     CLRF      0xc,0x0                                                                                         
0001d4   060b     DECF      0xb,0x1,0x0                    while(--big_counter);                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0001d6   0e00     MOVLW     0x0                                                                                             
0001d8   5a0c     SUBWFB    0xc,0x1,0x0                                                                                     
0001da   500b     MOVF      0xb,0x0,0x0                                                                                     
0001dc   100c     IORWF     0xc,0x0,0x0                                                                                     
0001de   e001     BZ        0x1e2                                                                                           
0001e0   d7f9     BRA       0x1d4                                                                                           
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0001e2   00ff     RESET                                    Reset();                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
0001e4   d001     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                       default:                                                             G:\USBPICPROG-SVN\Boot\sys\boot.c
0001e6   d000     BRA       0x1e8                          break;                                                           G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                   }//end switch()                                                          G:\USBPICPROG-SVN\Boot\sys\boot.c
0001e8   0e01     MOVLW     0x1                    trf_state = SENDING_RESP;                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ea   6e0a     MOVWF     0xa,0x0                                                                                         
0001ec   5008     MOVF      0x8,0x0,0x0            if(counter != 0)                                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
0001ee   e00a     BZ        0x204                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\boot.c
0001f0   c008     MOVFF     0x8,0x40d                  BOOT_BD_IN.Cnt = counter;                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
0001f2   f40d                                                                                                               
0001f4   0e40     MOVLW     0x40                       mUSBBufferReady(BOOT_BD_IN);                                         G:\USBPICPROG-SVN\Boot\sys\boot.c
0001f6   0104     MOVLB     0x4                                                                                             
0001f8   170c     ANDWF     0xc,0x1,0x1                                                                                     
0001fa   0104     MOVLB     0x4                                                                                             
0001fc   7d0c     BTG       0xc,0x6,0x1                                                                                     
0001fe   0e88     MOVLW     0x88                                                                                            
000200   0104     MOVLB     0x4                                                                                             
000202   130c     IORWF     0xc,0x1,0x1                                                                                     
                                                   }//end if                                                                G:\USBPICPROG-SVN\Boot\sys\boot.c
                                               }//end if                                                                    G:\USBPICPROG-SVN\Boot\sys\boot.c
000204   0012     RETURN    0x0            }//end BootService                                                               G:\USBPICPROG-SVN\Boot\sys\boot.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /** EOF boot.c ***************************************************************/  G:\USBPICPROG-SVN\Boot\sys\boot.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                Microchip USB C18 Firmware Version 1.0                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * FileName:        usb9.c                                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * -usb9.c-                                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * This main function in this file, USBCheckStdRequest() is called from the      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * usbctrltrf.c to check if a standard USB request has been received or not.     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * This is a mini-version of the actual usb9.c from the Microchip USB library.   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Many functions are commented out to make the whole bootload application fit   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * under 2KB, which is the size of the boot block.                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #include <p18cxxx.h>                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #include "io_cfg.h"                     // Required for self_power status        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /** V A R I A B L E S ********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBStdGetDscHandler(void);                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBStdSetCfgHandler(void);                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBStdGetStatusHandler(void);                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBStdFeatureReqHandler(void);                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /** D E C L A R A T I O N S **************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Function:        void USBCheckStdRequest(void)                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Overview:        This routine checks the setup data packet to see if it       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  knows how to handle it                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBCheckStdRequest(void)                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
00044a   0104     MOVLB     0x4                if(SetupPkt.RequestType != STANDARD) return;                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
00044c   5110     MOVF      0x10,0x0,0x1                                                                                    
00044e   0b60     ANDLW     0x60                                                                                            
000450   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000452   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000454   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000456   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
000458   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00045a   0900     IORLW     0x0                                                                                             
00045c   e001     BZ        0x460                                                                                           
00045e   0012     RETURN    0x0                                                                                             
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
000460   5111     MOVF      0x11,0x0,0x1       switch(SetupPkt.bRequest)                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
000462   0a08     XORLW     0x8                                                                                             
000464   e02f     BZ        0x4c4                                                                                           
000466   0a01     XORLW     0x1                                                                                             
000468   e02b     BZ        0x4c0                                                                                           
00046a   0a0f     XORLW     0xf                                                                                             
00046c   e008     BZ        0x47e                                                                                           
00046e   0a03     XORLW     0x3                                                                                             
000470   e001     BZ        0x474                                                                                           
000472   0012     RETURN    0x0                                                                                             
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   case SET_ADR:                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
000474   0e01     MOVLW     0x1                        ctrl_trf_session_owner = MUID_USB9;                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
000476   6e01     MOVWF     0x1,0x0                                                                                         
000478   0e04     MOVLW     0x4                        usb_device_state = ADR_PENDING_STATE;       // Update state only     G:\USBPICPROG-SVN\Boot\sys\usb9.c
00047a   6e0d     MOVWF     0xd,0x0                                                                                         
                                                       /* See USBCtrlTrfInHandler() in usbctrltrf.c for the next step */    G:\USBPICPROG-SVN\Boot\sys\usb9.c
00047c   0012     RETURN    0x0                        break;                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   case GET_DSC:                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
00047e   0e01     MOVLW     0x1                        ctrl_trf_session_owner = MUID_USB9;                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
000480   6e01     MOVWF     0x1,0x0                                                                                         
000482   0513     DECF      0x13,0x0,0x1               if(SetupPkt.bDscType == DSC_DEV)                                     G:\USBPICPROG-SVN\Boot\sys\usb9.c
000484   e106     BNZ       0x492                                                                                           
                                                       {                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
000486   0e94     MOVLW     0x94                           pSrc.bRom = (rom byte*)&device_dsc;                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
000488   6e02     MOVWF     0x2,0x0                                                                                         
00048a   0e06     MOVLW     0x6                                                                                             
00048c   6e03     MOVWF     0x3,0x0                                                                                         
00048e   0e12     MOVLW     0x12                           wCount._word = sizeof(device_dsc);  // Set data count            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                       }                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
000490   d011     BRA       0x4b4                      else if(SetupPkt.bDscType == DSC_CFG)                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
000492   0e02     MOVLW     0x2                                                                                             
000494   5d13     SUBWF     0x13,0x0,0x1                                                                                    
000496   e106     BNZ       0x4a4                                                                                           
                                                       {                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
000498   0ea6     MOVLW     0xa6                           pSrc.bRom = (rom byte*)&cfg01;                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
00049a   6e02     MOVWF     0x2,0x0                                                                                         
00049c   0e06     MOVLW     0x6                                                                                             
00049e   6e03     MOVWF     0x3,0x0                                                                                         
0004a0   0e20     MOVLW     0x20                           wCount._word = sizeof(cfg01);       // Set data count            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                       }                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004a2   d008     BRA       0x4b4                      else if(SetupPkt.bDscType == DSC_STR)                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004a4   0e03     MOVLW     0x3                                                                                             
0004a6   5d13     SUBWF     0x13,0x0,0x1                                                                                    
0004a8   e108     BNZ       0x4ba                                                                                           
                                                       {                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004aa   0ec6     MOVLW     0xc6                           pSrc.bRom = (rom byte*)&sd000;                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004ac   6e02     MOVWF     0x2,0x0                                                                                         
0004ae   0e06     MOVLW     0x6                                                                                             
0004b0   6e03     MOVWF     0x3,0x0                                                                                         
0004b2   0e04     MOVLW     0x4                            wCount._word = sizeof(sd000);       // Set data count            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004b4   6e06     MOVWF     0x6,0x0                                                                                         
0004b6   6a07     CLRF      0x7,0x0                                                                                         
                                                       }                                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004b8   d001     BRA       0x4bc                      else                                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                           /*                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                            * This is required to stall the DEVICE_QUALIFIER request        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                            */                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004ba   6a01     CLRF      0x1,0x0                        ctrl_trf_session_owner = MUID_NULL;                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004bc   820e     BSF       0xe,0x1,0x0                usb_stat.ctrl_trf_mem = _ROM;               // Set memory type       G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004be   0012     RETURN    0x0                        break;                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   case SET_CFG:                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004c0   ef6c     GOTO      0x4d8                      USBStdSetCfgHandler();                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004c2   f002                                                                                                               
                                                       break;                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   case GET_CFG:                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004c4   0e01     MOVLW     0x1                        ctrl_trf_session_owner = MUID_USB9;                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004c6   6e01     MOVWF     0x1,0x0                                                                                         
0004c8   0e0f     MOVLW     0xf                        pSrc.bRam = (byte*)&usb_active_cfg;         // Set Source            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004ca   6e02     MOVWF     0x2,0x0                                                                                         
0004cc   0e00     MOVLW     0x0                                                                                             
0004ce   6e03     MOVWF     0x3,0x0                                                                                         
0004d0   920e     BCF       0xe,0x1,0x0                usb_stat.ctrl_trf_mem = _RAM;               // Set memory type       G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004d2   0e01     MOVLW     0x1                        LSB(wCount) = 1;                            // Set data count        G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004d4   6e06     MOVWF     0x6,0x0                                                                                         
0004d6   0012     RETURN    0x0                        break;                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case GET_STATUS:                                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    USBStdGetStatusHandler();                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case CLR_FEATURE:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case SET_FEATURE:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    USBStdFeatureReqHandler();                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case GET_INTF:                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    ctrl_trf_session_owner = MUID_USB9;                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    pSrc.bRam = (byte*)&usb_alt_intf+SetupPkt.bIntfID;  // Set source  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    usb_stat.ctrl_trf_mem = _RAM;               // Set memory type     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    LSB(wCount) = 1;                            // Set data count      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case SET_INTF:                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    ctrl_trf_session_owner = MUID_USB9;                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    usb_alt_intf[SetupPkt.bIntfID] = SetupPkt.bAltID;                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //    break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case SET_DSC:                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   //case SYNCH_FRAME:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   default:                                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                       break;                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                               }//end switch                                                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           }//end USBCheckStdRequest                                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Function:        void USBStdGetDscHandler(void)                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Overview:        This routine handles the standard GET_DESCRIPTOR request.    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  It utilizes tables dynamically looks up descriptor size.     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  This routine should never have to be modified if the tables  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  in usbdsc.c are declared correctly.                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //void USBStdGetDscHandler(void)                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //{                                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    if(SetupPkt.bmRequestType == 0x80)                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    {                                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        switch(SetupPkt.bDscType)                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        {                                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            case DSC_DEV:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                pSrc.bRom = (rom byte*)&device_dsc;                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                wCount._word = sizeof(device_dsc);          // Set data count  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                break;                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            case DSC_CFG:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                pSrc.bRom = *(USB_CD_Ptr+SetupPkt.bDscIndex);                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                wCount._word = *(pSrc.wRom+1);              // Set data count  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                break;                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            case DSC_STR:                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                ctrl_trf_session_owner = MUID_USB9;                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                pSrc.bRom = *(USB_SD_Ptr+SetupPkt.bDscIndex);                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                wCount._word = *pSrc.bRom;                  // Set data count  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                break;                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        }//end switch                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        usb_stat.ctrl_trf_mem = _ROM;                       // Set memory type G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    }//end if                                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //}//end USBStdGetDscHandler                                                     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Function:        void USBStdSetCfgHandler(void)                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Overview:        This routine first disables all endpoints by clearing        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  UEP registers. It then configures (initializes) endpoints    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  specified in the modifiable section.                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           void USBStdSetCfgHandler(void)                                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004d8   0e01     MOVLW     0x1                ctrl_trf_session_owner = MUID_USB9;                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004da   6e01     MOVWF     0x1,0x0                                                                                         
                                               //mDisableEP1to15();                          // See usbdrv.h                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                               //ClearArray((byte*)&usb_alt_intf,MAX_NUM_INT);                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004dc   c412     MOVFF     0x412,0xf          usb_active_cfg = SetupPkt.bCfgValue;                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004de   f00f                                                                                                               
0004e0   0104     MOVLB     0x4                if(SetupPkt.bCfgValue == 0)                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004e2   5112     MOVF      0x12,0x0,0x1                                                                                    
0004e4   e103     BNZ       0x4ec                                                                                           
0004e6   0e05     MOVLW     0x5                    usb_device_state = ADDRESS_STATE;                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004e8   6e0d     MOVWF     0xd,0x0                                                                                         
0004ea   0012     RETURN    0x0                else                                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004ec   0e06     MOVLW     0x6                    usb_device_state = CONFIGURED_STATE;                                     G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004ee   6e0d     MOVWF     0xd,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   /* Modifiable Section */                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004f0   ef16     GOTO      0x2c                   BootInitEP();                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
0004f2   f000                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                   /* End modifiable section */                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                               }//end if(SetupPkt.bcfgValue == 0)                                           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           }//end USBStdSetCfgHandler                                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Function:        void USBStdGetStatusHandler(void)                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Overview:        This routine handles the standard GET_STATUS request         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //void USBStdGetStatusHandler(void)                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //{                                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    CtrlTrfData._byte0 = 0;                         // Initialize content      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    CtrlTrfData._byte1 = 0;                                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    switch(SetupPkt.Recipient)                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    {                                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        case RCPT_DEV:                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            /*                                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //             * _byte0: bit0: Self-Powered Status [0] Bus-Powered [1] Self-Powered G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //             *         bit1: RemoteWakeup        [0] Disabled    [1] Enabled   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //             */                                                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            if(self_power == 1)                     // self_power defined in io_cfg.h G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                CtrlTrfData._byte0|=0b000000001;    // Set bit0                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            if(usb_stat.RemoteWakeup == 1)          // usb_stat defined in usbmmap.c G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                CtrlTrfData._byte0|=0b00000010;     // Set bit1                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        case RCPT_INTF:                                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;     // No data to update       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        case RCPT_EP:                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            ctrl_trf_session_owner = MUID_USB9;                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            /*                                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //             * _byte0: bit0: Halt Status [0] Not Halted [1] Halted             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //             */                                                                G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            if(*pDst.bRam & _BSTALL)    // Use _BSTALL as a bit mask           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                CtrlTrfData._byte0=0x01;// Set bit0                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            break;                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    }//end switch                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    if(ctrl_trf_session_owner == MUID_USB9)                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    {                                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        pSrc.bRam = (byte*)&CtrlTrfData;            // Set Source              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        usb_stat.ctrl_trf_mem = _RAM;               // Set memory type         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        LSB(wCount) = 2;                            // Set data count          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    }//end if(...)                                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //}//end USBStdGetStatusHandler                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Function:        void USBStdFeatureReqHandler(void)                           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Overview:        This routine handles the standard SET & CLEAR FEATURES       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                  requests                                                     G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //void USBStdFeatureReqHandler(void)                                             G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //{                                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    if((SetupPkt.bFeature == DEVICE_REMOTE_WAKEUP)&&                           G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //       (SetupPkt.Recipient == RCPT_DEV))                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    {                                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        ctrl_trf_session_owner = MUID_USB9;                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        if(SetupPkt.bRequest == SET_FEATURE)                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            usb_stat.RemoteWakeup = 1;                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        else                                                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            usb_stat.RemoteWakeup = 0;                                         G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    }//end if                                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    if((SetupPkt.bFeature == ENDPOINT_HALT)&&                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //       (SetupPkt.Recipient == RCPT_EP)&&                                       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //       (SetupPkt.EPNum != 0))                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    {                                                                          G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        ctrl_trf_session_owner = MUID_USB9;                                    G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        /* Must do address calculation here */                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        pDst.bRam = (byte*)&ep0Bo+(SetupPkt.EPNum*8)+(SetupPkt.EPDir*4);       G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        if(SetupPkt.bRequest == SET_FEATURE)                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            *pDst.bRam = _USIE|_BSTALL;                                        G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        else                                                                   G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        {                                                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            if(SetupPkt.EPDir == 1) // IN                                      G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                *pDst.bRam = _UCPU;                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //            else                                                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //                *pDst.bRam = _USIE|_DAT0|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //        }//end if                                                              G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //    }//end if                                                                  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           //}//end USBStdFeatureReqHandler                                                 G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /** EOF usb9.c ***************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usb9.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                Microchip USB C18 Firmware Version 1.0                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * FileName:        usbmmap.c                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * -usbmmap.c-                                                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * USB Memory Map                                                                G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * This file is the USB memory manager; it serves as a compile-time memory       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * allocator for the USB endpoints. It uses the compile time options passed      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * from usbcfg.h to instantiate endpoints and endpoint buffer.                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Each endpoint requires to have a set of Buffer Descriptor registers(BDT).     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * A BDT is 4-byte long and has a specific RAM location for each endpoint.       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The BDT for endpoint 0 out is located at address 0x400 to 0x403.              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The BDT for endpoint 0 in is located at address 0x404 to 0x407.               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The BDT for endpoint 1 out is located at address 0x408 to 0x40B.              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * and so on... The above allocation assumes the Ping-Pong Buffer Mode 0 is      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * used. These locations are already hard-wired in the silicon. The point        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * of doing instantiation, i.e. volatile far BDT ep0Bo;, is to provide the       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * C compiler a way to address each variable directly. This is very important    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * because when a register can be accessed directly, it saves execution time     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * and reduces program size.                                                     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Endpoints are defined using the endpoint number and the direction             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * of transfer. For simplicity, usbmmap.c only uses the endpoint number          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * in the BDT register allocation scheme. This means if the usbcfg.h states      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * that the MAX_EP_NUMBER is number 1, then four BDTs will be                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * instantiated: one each for endpoint0 in and endpoint0 out, which must         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * always be instantiated for control transfer by default, and one each sets     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * for endpoint1 in and endpoint1 out. The naming convention for instantiating   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * BDT is                                                                        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * ep<#>B<d>                                                                     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * where # is the endpoint number, and d is the direction of                     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * transfer, which could be either <i> or <o>.                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The USB memory manager uses MAX_EP_NUMBER, as defined in usbcfg.h, to define  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * the endpoints to be instantiated. This represents the highest endpoint        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * number to be allocated, not how many endpoints are used. Since the BDTs for   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * endpoints have hardware-assigned addresses in Bank 4, setting this value too  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * high may lead to inefficient use of data RAM. For example, if an application  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * uses only endpoints EP0 and EP4, then the MAX_EP_NUMBER is 4, and not 2.      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The in-between endpoint BDTs in this example (EP1, EP2, and EP3) go unused,   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * and the 24 bytes of memory associated with them are wasted. It does not make  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * much sense to skip endpoints, but the final decision lies with the user.      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The next step is to assign the instantiated BDTs to different                 G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * USB functions. The firmware framework fundamentally assumes that every USB    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * function should know which endpoint it is using, i.e., the default control    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * transfer should know that it is using endpoint 0 in and endpoint 0 out.       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * A HID class can choose which endpoint it wants to use, but once chosen, it    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * should always know the number of the endpoint.                                G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The assignment of endpoints to USB functions is managed centrally             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * in usbcfg.h. This helps prevent the mistake of having more                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * than one USB function using the same endpoint. The "Endpoint Allocation"      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * section in usbcfg.h provides examples for how to map USB endpoints to USB     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * functions.                                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Quite a few things can be mapped in that section. There is no                 G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * one correct way to do the mapping and the user has the choice to              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * choose a method that is most suitable to the application.                     G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Typically, however, a user will want to map the following for a given         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * USB interface function:                                                       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * 1. The USB interface ID                                                       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * 2. The endpoint control registers (UEPn)                                      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * 3. The BDT registers (ep<#>B<d>)                                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * 4. The endpoint size                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Example: Assume a USB device class "foo", which uses one out endpoint         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *          of size 64-byte and one in endpoint of size 64-byte, then:           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * #define FOO_INTF_ID          0x00                                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * #define FOO_UEP              UEP1                                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * #define FOO_BD_OUT           ep1Bo                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * #define FOO_BD_IN            ep1Bi                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * #define FOO_EP_SIZE          64                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The mapping above has chosen class "foo" to use endpoint 1.                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The names are arbitrary and can be anything other than FOO_??????.            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * For abstraction, the code for class "foo" should use the abstract             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * definitions of FOO_BD_OUT,FOO_BD_IN, and not ep1Bo or ep1Bi.                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Note that the endpoint size defined in the usbcfg.h file is again             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * used in the usbmmap.c file. This shows that the relationship between          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * the two files are tightly related.                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The endpoint buffer for each USB function must be located in the              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * dual-port RAM area and has to come after all the BDTs have been               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * instantiated. An example declaration is:                                      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * volatile far unsigned char[FOO_EP_SIZE] data;                                 G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * The 'volatile' keyword tells the compiler not to perform any code             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * optimization on this variable because its content could be modified           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * by the hardware. The 'far' keyword tells the compiler that this variable      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * is not located in the Access RAM area (0x000 - 0x05F).                        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * For the variable to be globally accessible by other files, it should be       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * declared in the header file usbmmap.h as an extern definition, such as        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * extern volatile far unsigned char[FOO_EP_SIZE] data;                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Conclusion:                                                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * In a short summary, the dependencies between usbcfg and usbmmap can           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * be shown as:                                                                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * usbcfg[MAX_EP_NUMBER] -> usbmmap                                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * usbmmap[ep<#>B<d>] -> usbcfg                                                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * usbcfg[EP size] -> usbmmap                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * usbcfg[abstract ep definitions] -> usb9/hid/cdc/etc class code                G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * usbmmap[endpoint buffer variable] -> usb9/hid/cdc/etc class code              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Data mapping provides a means for direct addressing of BDT and endpoint       G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * buffer. This means less usage of pointers, which equates to a faster and      G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * smaller program code.                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /** U S B  G L O B A L  V A R I A B L E S ************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           byte usb_device_state;          // Device States: DETACHED, ATTACHED, ...        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           USB_DEVICE_STATUS usb_stat;     // Global USB flags                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           byte usb_active_cfg;            // Value of current configuration                G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           byte usb_alt_intf[MAX_NUM_INT]; // Array to keep track of the current alternate  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                           // setting for each interface ID                 G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /** U S B  F I X E D  L O C A T I O N  V A R I A B L E S *********************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #pragma udata usbram4=0x400     //See Linker Script,usb4:0x400-0x4FF(256-byte)   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Section A: Buffer Descriptor Table                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * - 0x400 - 0x4FF(max)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * - MAX_EP_NUMBER is defined in autofiles\usbcfg.h                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * - BDT data type is defined in system\usb\usbmmap.h                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(0 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep0Bo;         //Endpoint #0 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep0Bi;         //Endpoint #0 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(1 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep1Bo;         //Endpoint #1 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep1Bi;         //Endpoint #1 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(2 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep2Bo;         //Endpoint #2 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep2Bi;         //Endpoint #2 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(3 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep3Bo;         //Endpoint #3 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep3Bi;         //Endpoint #3 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(4 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep4Bo;         //Endpoint #4 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep4Bi;         //Endpoint #4 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(5 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep5Bo;         //Endpoint #5 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep5Bi;         //Endpoint #5 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(6 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep6Bo;         //Endpoint #6 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep6Bi;         //Endpoint #6 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(7 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep7Bo;         //Endpoint #7 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep7Bi;         //Endpoint #7 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(8 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep8Bo;         //Endpoint #8 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep8Bi;         //Endpoint #8 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(9 <= MAX_EP_NUMBER)                                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep9Bo;         //Endpoint #9 BD Out                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep9Bi;         //Endpoint #9 BD In                              G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(10 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep10Bo;        //Endpoint #10 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep10Bi;        //Endpoint #10 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(11 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep11Bo;        //Endpoint #11 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep11Bi;        //Endpoint #11 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(12 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep12Bo;        //Endpoint #12 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep12Bi;        //Endpoint #12 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(13 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep13Bo;        //Endpoint #13 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep13Bi;        //Endpoint #13 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(14 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep14Bo;        //Endpoint #14 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep14Bi;        //Endpoint #14 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #if(15 <= MAX_EP_NUMBER)                                                         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep15Bo;        //Endpoint #15 BD Out                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BDT ep15Bi;        //Endpoint #15 BD In                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #endif                                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Section B: EP0 Buffer Space                                                   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            ******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * - Two buffer areas are defined:                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *   A. CTRL_TRF_SETUP                                                           G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *      - Detailed data structure allows direct adddressing of bits and bytes.   G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *   B. CTRL_TRF_DATA                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *      - Size = EP0_BUFF_SIZE as defined in autofiles\usbcfg.h                  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *      - Data structure allows direct adddressing of the first 8 bytes.         G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * - Both data types are defined in system\usb\usbdefs\usbdefs_ep0_buff.h        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far CTRL_TRF_SETUP SetupPkt;                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far CTRL_TRF_DATA CtrlTrfData;                                          G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            * Section C: Buffer                                                             G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            ******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           volatile far BOOT_DATA_PACKET dataPacket;                                        G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /** EOF usbmmap.c ************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbmmap.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                Microchip USB C18 Firmware Version 1.0                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * FileName:        usbctrltrf.c                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Rawin Rojvanit       11/19/04    Original.                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * -usbctrltrf.c-                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * This file contains functions which handle the Control Transfer mechanism.     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * The only function that is of interest to an end user is the                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * USBCtrlTrfSetupHandler(), which has a section that calls different            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * USB request handlers. A default call to the USBCheckStdRequest always         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * exist and cannot be removed. USBCheckStdRequest contains handlers             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * for the requests specified in chapter 9 of the USB specification.             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * If a request cannot be serviced by USBCheckStdRequest, then it means the      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * request is a class specific request. All device class request handlers        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * in a project should be called from USBCtrlTrfSetupHandler().                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * If no handlers in the project know how to service a request, then the         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * ctrl_trf_session_owner variable would still have the value of MUID_NULL.      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * The MUID_NULL value would cause the USBCtrlEPServiceComplete() to stall       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * the control endpoint, effectively telling the USB host that the               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * request cannot be serviced.                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * This is a mini-version of the actual usbctrltrf.c from the Microchip USB      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Library. Some functions were optimized to handle byte only operation instead  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * of supporting both byte and word operations.                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * This helps to decrease the the bootload application size to fit               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * under 2KB, which is the size of the boot block.                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           #include <p18cxxx.h>                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /** V A R I A B L E S ********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           byte ctrl_trf_state;                // Control Transfer State                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           byte ctrl_trf_session_owner;        // Current transfer session owner            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           POINTER pSrc;                       // Data source pointer                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           POINTER pDst;                       // Data destination pointer                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           WORD wCount;                        // Data counter                              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlTrfSetupHandler(void);                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void);                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void);                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /** D E C L A R A T I O N S **************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlEPService(void)                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    USTAT is loaded with a valid endpoint address.               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        USBCtrlEPService checks for three transaction types that     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  it knows how to service and services them:                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  1. EP0 SETUP                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  2. EP0 OUT                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  3. EP0 IN                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  It ignores all other types (i.e. EP1, EP2, etc.)             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlEPService(void)                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000254   506c     MOVF      0x6c,0x0,0x0       if(USTAT == EP00_OUT)                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000256   e002     BZ        0x25c                                                                                           
000258   0e00     MOVLW     0x0                                                                                             
00025a   d001     BRA       0x25e                                                                                           
00025c   0e01     MOVLW     0x1                                                                                             
00025e   0900     IORLW     0x0                                                                                             
000260   e00b     BZ        0x278                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000262   0104     MOVLB     0x4                    if(ep0Bo.Stat.PID == SETUP_TOKEN)           // EP0 SETUP                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000264   5100     MOVF      0x0,0x0,0x1                                                                                     
000266   0b3c     ANDLW     0x3c                                                                                            
000268   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00026a   42e8     RRNCF     0xe8,0x1,0x0                                                                                    
00026c   080d     SUBLW     0xd                                                                                             
00026e   e102     BNZ       0x274                                                                                           
000270   ef45     GOTO      0x28a                      USBCtrlTrfSetupHandler();                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000272   f001                                                                                                               
                                                   else                                        // EP0 OUT                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000274   ef4e     GOTO      0x29c                      USBCtrlTrfOutHandler();                                              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000276   f001                                                                                                               
                                               }                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000278   506c     MOVF      0x6c,0x0,0x0       else if(USTAT == EP00_IN)                       // EP0 IN                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00027a   e002     BZ        0x280                                                                                           
00027c   0e00     MOVLW     0x0                                                                                             
00027e   d001     BRA       0x282                                                                                           
000280   0e01     MOVLW     0x1                                                                                             
000282   0904     IORLW     0x4                                                                                             
000284   e001     BZ        0x288                                                                                           
000286   d818     RCALL     0x2b8                  USBCtrlTrfInHandler();                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000288   0012     RETURN    0x0            }//end USBCtrlEPService                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlTrfSetupHandler(void)                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    SetupPkt buffer is loaded with valid USB Setup Data          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        This routine is a task dispatcher and has 3 stages.          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  1. It initializes the control transfer state machine.        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  2. It calls on each of the module that may know how to       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     service the Setup Request from the host.                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     Module Example: USB9, HID, CDC, MSD, ...                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     As new classes are added, ClassReqHandler table in        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     usbdsc.c should be updated to call all available          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     class handlers.                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  3. Once each of the modules has had a chance to check if     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     it is responsible for servicing the request, stage 3      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     then checks direction of the transfer to determine how    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     to prepare EP0 for the control transfer.                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     Refer to USBCtrlEPServiceComplete() for more details.     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            Microchip USB Firmware has three different states for        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  the control transfer state machine:                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  1. WAIT_SETUP                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  2. CTRL_TRF_TX                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  3. CTRL_TRF_RX                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  Refer to firmware manual to find out how one state           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  is transitioned to another.                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  A Control Transfer is composed of many USB transactions.     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  When transferring data over multiple transactions,           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  it is important to keep track of data source, data           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  destination, and data count. These three parameters are      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  stored in pSrc,pDst, and wCount. A flag is used to           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  note if the data source is from ROM or RAM.                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00028a   d8d4     RCALL     0x434          void USBCtrlTrfSetupHandler(void)                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               byte i;                                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* Stage 1 */                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00028c   6a00     CLRF      0x0,0x0            ctrl_trf_state = WAIT_SETUP;                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00028e   6a01     CLRF      0x1,0x0            ctrl_trf_session_owner = MUID_NULL;     // Set owner to NULL                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000290   6a06     CLRF      0x6,0x0            wCount._word = 0;                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000292   6a07     CLRF      0x7,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* Stage 2 */                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000294   ec25     CALL      0x44a,0x0          USBCheckStdRequest();                   // See system\usb9\usb9.c            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000296   f002                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* Modifiable Section */                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* Insert other USB Device Class Request Handlers here */                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* End Modifiable Section */                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /* Stage 3 */                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000298   d87e     RCALL     0x396              USBCtrlEPServiceComplete();                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00029a   d0d2     BRA       0x440          }//end USBCtrlTrfSetupHandler                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlTrfOutHandler(void)                              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        This routine handles an OUT transaction according to         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  which control transfer state is currently active.            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            Note that if the the control transfer was from               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  host to device, the session owner should be notified         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  at the end of each OUT transaction to service the            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  received data.                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlTrfOutHandler(void)                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00029c   0e02     MOVLW     0x2                if(ctrl_trf_state == CTRL_TRF_RX)                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00029e   5c00     SUBWF     0x0,0x0,0x0                                                                                     
0002a0   e109     BNZ       0x2b4                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002a2   d858     RCALL     0x354                  USBCtrlTrfRxService();                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   /*                                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    * Don't have to worry about overwriting _KEEP bit                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    * because if _KEEP was set, TRNIF would not have been                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    * generated in the first place.                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    */                                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002a4   0104     MOVLB     0x4                    if(ep0Bo.Stat.DTS == 0)                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002a6   bd00     BTFSC     0x0,0x6,0x1                                                                                     
0002a8   d002     BRA       0x2ae                                                                                           
0002aa   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ac   d001     BRA       0x2b0                  else                                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ae   0e88     MOVLW     0x88                       ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002b0   6f00     MOVWF     0x0,0x1                                                                                         
                                               }                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002b2   0012     RETURN    0x0                else    // CTRL_TRF_TX                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002b4   effd     GOTO      0x3fa                  USBPrepareForNextSetupTrf();                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002b6   f001                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           }//end USBCtrlTrfOutHandler                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlTrfInHandler(void)                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        This routine handles an IN transaction according to          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  which control transfer state is currently active.            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            A Set Address Request must not change the acutal address     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  of the device until the completion of the control            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  transfer. The end of the control transfer for Set Address    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  Request is an IN transaction. Therefore it is necessary      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  to service this unique situation when the condition is       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  right. Macro mUSBCheckAdrPendingState is defined in          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  usb9.h and its function is to specifically service this      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  event.                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlTrfInHandler(void)                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002b8   0e04     MOVLW     0x4                mUSBCheckAdrPendingState();         // Must check if in ADR_PENDING_STATE    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ba   5c0d     SUBWF     0xd,0x0,0x0                                                                                     
0002bc   e109     BNZ       0x2d0                                                                                           
0002be   c412     MOVFF     0x412,0xf6e                                                                                     
0002c0   ff6e                                                                                                               
0002c2   506e     MOVF      0x6e,0x0,0x0                                                                                    
0002c4   0800     SUBLW     0x0                                                                                             
0002c6   e202     BC        0x2cc                                                                                           
0002c8   0e05     MOVLW     0x5                                                                                             
0002ca   d001     BRA       0x2ce                                                                                           
0002cc   0e03     MOVLW     0x3                                                                                             
0002ce   6e0d     MOVWF     0xd,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002d0   0400     DECF      0x0,0x0,0x0        if(ctrl_trf_state == CTRL_TRF_TX)                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002d2   e109     BNZ       0x2e6                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002d4   d80a     RCALL     0x2ea                  USBCtrlTrfTxService();                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002d6   0104     MOVLB     0x4                    if(ep0Bi.Stat.DTS == 0)                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002d8   bd04     BTFSC     0x4,0x6,0x1                                                                                     
0002da   d002     BRA       0x2e0                                                                                           
0002dc   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002de   d001     BRA       0x2e2                  else                                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002e0   0e88     MOVLW     0x88                       ep0Bi.Stat._byte = _USIE|_DAT0|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002e2   6f04     MOVWF     0x4,0x1                                                                                         
                                               }                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002e4   0012     RETURN    0x0                else // CTRL_TRF_RX                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002e6   effd     GOTO      0x3fa                  USBPrepareForNextSetupTrf();                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002e8   f001                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           }//end USBCtrlTrfInHandler                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlTrfTxService(void)                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    pSrc, wCount, and usb_stat.ctrl_trf_mem are setup properly.  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        This routine should be called from only two places.          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  One from USBCtrlEPServiceComplete() and one from             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  USBCtrlTrfInHandler(). It takes care of managing a           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  transfer over multiple USB transactions.                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            This routine works with isochronous endpoint larger than     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  256 bytes and is shown here as an example of how to deal     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  with BC9 and BC8. In reality, a control endpoint can never   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  be larger than 64 bytes.                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ea   d8a4     RCALL     0x434          void USBCtrlTrfTxService(void)                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               byte byte_to_send;                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                * First, have to figure out how many byte of data to send.                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ec   0e08     MOVLW     0x8                if(wCount._word < EP0_BUFF_SIZE)                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002ee   5c06     SUBWF     0x6,0x0,0x0                                                                                     
0002f0   0e00     MOVLW     0x0                                                                                             
0002f2   5807     SUBWFB    0x7,0x0,0x0                                                                                     
0002f4   e204     BC        0x2fe                                                                                           
0002f6   d888     RCALL     0x408                  byte_to_send = wCount._word;                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002f8   c006     MOVFF     0x6,0xfef                                                                                       
0002fa   ffef                                                                                                               
0002fc   d003     BRA       0x304              else                                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0002fe   d884     RCALL     0x408                  byte_to_send = EP0_BUFF_SIZE;                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000300   0e08     MOVLW     0x8                                                                                             
000302   6eef     MOVWF     0xef,0x0                                                                                        
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000304   d881     RCALL     0x408              ep0Bi.Cnt = byte_to_send;                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000306   cfef     MOVFF     0xfef,0x405                                                                                     
000308   f405                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                * Subtract the number of bytes just about to be sent from the total.        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00030a   50ef     MOVF      0xef,0x0,0x0       wCount._word -= byte_to_send;                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00030c   6a12     CLRF      0x12,0x0                                                                                        
00030e   50e8     MOVF      0xe8,0x0,0x0                                                                                    
000310   5e06     SUBWF     0x6,0x1,0x0                                                                                     
000312   5012     MOVF      0x12,0x0,0x0                                                                                    
000314   5a07     SUBWFB    0x7,0x1,0x0                                                                                     
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000316   0e18     MOVLW     0x18               pDst.bRam = (byte*)&CtrlTrfData;        // Set destination pointer           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000318   6e04     MOVWF     0x4,0x0                                                                                         
00031a   0e04     MOVLW     0x4                                                                                             
00031c   6e05     MOVWF     0x5,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00031e   d874     RCALL     0x408              while(byte_to_send)                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000320   50ef     MOVF      0xef,0x0,0x0                                                                                    
000322   e017     BZ        0x352                                                                                           
000350   d7e6     BRA       0x31e                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000324   a20e     BTFSS     0xe,0x1,0x0            if(usb_stat.ctrl_trf_mem == _ROM)                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000326   d007     BRA       0x336                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000328   c002     MOVFF     0x2,0xff6                  *pDst.bRam = *pSrc.bRom;                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00032a   fff6                                                                                                               
00032c   c003     MOVFF     0x3,0xff7                                                                                       
00032e   fff7                                                                                                               
000330   0008     TBLRD                                                                                                     
000332   50f5     MOVF      0xf5,0x0,0x0                                                                                    
                                                       pSrc.bRom++;                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   }                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000334   d005     BRA       0x340                  else                                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000336   c002     MOVFF     0x2,0xfe9                  *pDst.bRam = *pSrc.bRam;                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000338   ffe9                                                                                                               
00033a   c003     MOVFF     0x3,0xfea                                                                                       
00033c   ffea                                                                                                               
00033e   50ef     MOVF      0xef,0x0,0x0                                                                                    
000340   d870     RCALL     0x422                                                                                           
000422   6ee6     MOVWF     0xe6,0x0                                                                                        
000424   c004     MOVFF     0x4,0xfe9                                                                                       
000426   ffe9                                                                                                               
000428   c005     MOVFF     0x5,0xfea                                                                                       
00042a   ffea                                                                                                               
00042c   52e5     MOVF      0xe5,0x1,0x0                                                                                    
00042e   50e7     MOVF      0xe7,0x0,0x0                                                                                    
000430   6eef     MOVWF     0xef,0x0                                                                                        
000432   0012     RETURN    0x0                                                                                             
000342   2a02     INCF      0x2,0x1,0x0                pSrc.bRam++;                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000344   0e00     MOVLW     0x0                                                                                             
000346   2203     ADDWFC    0x3,0x1,0x0                                                                                     
                                                   }//end if else                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000348   2a04     INCF      0x4,0x1,0x0            pDst.bRam++;                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00034a   2205     ADDWFC    0x5,0x1,0x0                                                                                     
00034c   d85d     RCALL     0x408                  byte_to_send--;                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00034e   06ef     DECF      0xef,0x1,0x0                                                                                    
                                               }//end while                                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000352   d076     BRA       0x440          }//end USBCtrlTrfTxService                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlTrfRxService(void)                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    pDst and wCount are setup properly.                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  pSrc is always &CtrlTrfData                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  usb_stat.ctrl_trf_mem is always _RAM.                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  wCount should be set to 0 at the start of each control       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  transfer.                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        *** This routine is only partially complete. Check for       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  new version of the firmware.                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000354   d86f     RCALL     0x434          void USBCtrlTrfRxService(void)                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000434   cfd9     MOVFF     0xfd9,0xfe6                                                                                     
000436   ffe6                                                                                                               
000438   cfe1     MOVFF     0xfe1,0xfd9                                                                                     
00043a   ffd9                                                                                                               
00043c   52e6     MOVF      0xe6,0x1,0x0                                                                                    
00043e   0012     RETURN    0x0                                                                                             
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               byte byte_to_read;                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000356   d858     RCALL     0x408              byte_to_read = ep0Bo.Cnt;                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000358   c401     MOVFF     0x401,0xfef                                                                                     
00035a   ffef                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                * Accumulate total number of bytes read                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00035c   d855     RCALL     0x408              wCount._word = wCount._word + byte_to_read;                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00035e   50ef     MOVF      0xef,0x0,0x0                                                                                    
000360   2406     ADDWF     0x6,0x0,0x0                                                                                     
000362   6e06     MOVWF     0x6,0x0                                                                                         
000364   0e00     MOVLW     0x0                                                                                             
000366   2007     ADDWFC    0x7,0x0,0x0                                                                                     
000368   6e07     MOVWF     0x7,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00036a   0e18     MOVLW     0x18               pSrc.bRam = (byte*)&CtrlTrfData;                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00036c   6e02     MOVWF     0x2,0x0                                                                                         
00036e   0e04     MOVLW     0x4                                                                                             
000370   6e03     MOVWF     0x3,0x0                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000372   d84a     RCALL     0x408              while(byte_to_read)                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000374   50ef     MOVF      0xef,0x0,0x0                                                                                    
000376   e00e     BZ        0x394                                                                                           
000392   d7ef     BRA       0x372                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000378   c002     MOVFF     0x2,0xfe9              *pDst.bRam = *pSrc.bRam;                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00037a   ffe9                                                                                                               
00037c   c003     MOVFF     0x3,0xfea                                                                                       
00037e   ffea                                                                                                               
000380   50ef     MOVF      0xef,0x0,0x0                                                                                    
000382   d84f     RCALL     0x422                                                                                           
000384   2a04     INCF      0x4,0x1,0x0            pDst.bRam++;                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000386   0e00     MOVLW     0x0                                                                                             
000388   2205     ADDWFC    0x5,0x1,0x0                                                                                     
00038a   2a02     INCF      0x2,0x1,0x0            pSrc.bRam++;                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00038c   2203     ADDWFC    0x3,0x1,0x0                                                                                     
00038e   d83c     RCALL     0x408                  byte_to_read--;                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000390   06ef     DECF      0xef,0x1,0x0                                                                                    
000408   cfd9     MOVFF     0xfd9,0xfe9                                                                                     
00040a   ffe9                                                                                                               
00040c   cfda     MOVFF     0xfda,0xfea                                                                                     
00040e   ffea                                                                                                               
000410   0012     RETURN    0x0                                                                                             
                                               }//end while(byte_to_read)                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000394   d055     BRA       0x440          }//end USBCtrlTrfRxService                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000440   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000442   52e5     MOVF      0xe5,0x1,0x0                                                                                    
000444   cfe7     MOVFF     0xfe7,0xfd9                                                                                     
000446   ffd9                                                                                                               
000448   0012     RETURN    0x0                                                                                             
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBCtrlEPServiceComplete(void)                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        This routine wrap up the ramaining tasks in servicing        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  a Setup Request. Its main task is to set the endpoint        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  controls appropriately for a given situation. See code       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  below.                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  There are three main scenarios:                              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  a) There was no handler for the Request, in this case        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     a STALL should be sent out.                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  b) The host has requested a read control transfer,           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     endpoints are required to be setup in a specific way.     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  c) The host has requested a write control transfer, or       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     a control data stage is not required, endpoints are       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                     required to be setup in a specific way.                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  Packet processing is resumed by clearing PKTDIS bit.         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBCtrlEPServiceComplete(void)                                              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000396   5001     MOVF      0x1,0x0,0x0        if(ctrl_trf_session_owner == MUID_NULL)                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000398   e105     BNZ       0x3a4                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   /*                                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    * If no one knows how to service this request then stall.               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    * Must also prepare EP0 to receive the next SETUP transaction.          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                    */                                                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00039a   d83b     RCALL     0x412                  ep0Bo.Cnt = EP0_BUFF_SIZE;                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   ep0Bo.ADR = (byte*)&SetupPkt;                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00039c   0e84     MOVLW     0x84                   ep0Bo.Stat._byte = _USIE|_BSTALL;                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00039e   6f00     MOVWF     0x0,0x1                                                                                         
0003a0   0104     MOVLB     0x4                    ep0Bi.Stat._byte = _USIE|_BSTALL;                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               }                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003a2   d018     BRA       0x3d4              else    // A module has claimed ownership of the control transfer session.   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003a4   0104     MOVLB     0x4                    if(SetupPkt.DataDir == DEV_TO_HOST)                                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003a6   af10     BTFSS     0x10,0x7,0x1                                                                                    
0003a8   d017     BRA       0x3d8                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003aa   5006     MOVF      0x6,0x0,0x0                if(SetupPkt.wLength < wCount._word)                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003ac   5d16     SUBWF     0x16,0x0,0x1                                                                                    
0003ae   5007     MOVF      0x7,0x0,0x0                                                                                     
0003b0   5917     SUBWFB    0x17,0x0,0x1                                                                                    
0003b2   e204     BC        0x3bc                                                                                           
0003b4   c416     MOVFF     0x416,0x6                      wCount._word = SetupPkt.wLength;                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003b6   f006                                                                                                               
0003b8   c417     MOVFF     0x417,0x7                                                                                       
0003ba   f007                                                                                                               
0003bc   df96     RCALL     0x2ea                      USBCtrlTrfTxService();                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003be   0e01     MOVLW     0x1                        ctrl_trf_state = CTRL_TRF_TX;                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003c0   6e00     MOVWF     0x0,0x0                                                                                         
                                                       /*                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * Control Read:                                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * <SETUP[0]><IN[1]><IN[0]>...<OUT[1]> | <SETUP[0]>                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * 1. Prepare OUT EP to respond to early termination                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * NOTE:                                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * If something went wrong during the control transfer,              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * the last status stage may not be sent by the host.                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * When this happens, two different things could happen              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * depending on the host.                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * a) The host could send out a RESET.                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * b) The host could send out a new SETUP transaction                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *    without sending a RESET first.                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * To properly handle case (b), the OUT EP must be setup             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * to receive either a zero length OUT transaction, or a             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * new SETUP transaction.                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * Since the SETUP transaction requires the DTS bit to be            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * DAT0 while the zero length OUT status requires the DTS            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * bit to be DAT1, the DTS bit check by the hardware should          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * be disabled. This way the SIE could accept either of              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * the two transactions.                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * Furthermore, the Cnt byte should be set to prepare for            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * the SETUP data (8-byte or more), and the buffer address           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * should be pointed to SetupPkt.                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        */                                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003c2   d827     RCALL     0x412                      ep0Bo.Cnt = EP0_BUFF_SIZE;                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                       ep0Bo.ADR = (byte*)&SetupPkt;                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003c4   0e80     MOVLW     0x80                       ep0Bo.Stat._byte = _USIE;           // Note: DTSEN is 0!             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003c6   6f00     MOVWF     0x0,0x1                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                       /*                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * 2. Prepare IN EP to transfer data, Cnt should have                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *    been initialized by responsible request owner.                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        */                                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003c8   0104     MOVLB     0x4                        ep0Bi.ADR = (byte*)&CtrlTrfData;                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003ca   0e18     MOVLW     0x18                                                                                            
0003cc   6f06     MOVWF     0x6,0x1                                                                                         
0003ce   0e04     MOVLW     0x4                                                                                             
0003d0   6f07     MOVWF     0x7,0x1                                                                                         
0003d2   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003d4   6f04     MOVWF     0x4,0x1                                                                                         
                                                   }                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003d6   d00f     BRA       0x3f6                  else    // (SetupPkt.DataDir == HOST_TO_DEV)                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003d8   0e02     MOVLW     0x2                        ctrl_trf_state = CTRL_TRF_RX;                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003da   6e00     MOVWF     0x0,0x0                                                                                         
                                                       /*                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * Control Write:                                                    G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * <SETUP[0]><OUT[1]><OUT[0]>...<IN[1]> | <SETUP[0]>                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * 1. Prepare IN EP to respond to early termination                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *    This is the same as a Zero Length Packet Response              G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        *    for control transfer without a data stage                      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        */                                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003dc   0104     MOVLB     0x4                        ep0Bi.Cnt = 0;                                                       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003de   6b05     CLRF      0x5,0x1                                                                                         
0003e0   0ec8     MOVLW     0xc8                       ep0Bi.Stat._byte = _USIE|_DAT1|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003e2   6f04     MOVWF     0x4,0x1                                                                                         
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                       /*                                                                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        * 2. Prepare OUT EP to receive data.                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                        */                                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003e4   0104     MOVLB     0x4                        ep0Bo.Cnt = EP0_BUFF_SIZE;                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003e6   0e08     MOVLW     0x8                                                                                             
0003e8   6f01     MOVWF     0x1,0x1                                                                                         
0003ea   0e18     MOVLW     0x18                       ep0Bo.ADR = (byte*)&CtrlTrfData;                                     G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003ec   6f02     MOVWF     0x2,0x1                                                                                         
0003ee   0e04     MOVLW     0x4                                                                                             
0003f0   6f03     MOVWF     0x3,0x1                                                                                         
0003f2   0ec8     MOVLW     0xc8                       ep0Bo.Stat._byte = _USIE|_DAT1|_DTSEN;                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003f4   6f00     MOVWF     0x0,0x1                                                                                         
                                                   }//end if(SetupPkt.DataDir == DEV_TO_HOST)                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               }//end if(ctrl_trf_session_owner == MUID_NULL)                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                * PKTDIS bit is set when a Setup Transaction is received.                   G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                * Clear to resume packet processing.                                        G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003f6   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003f8   0012     RETURN    0x0            }//end USBCtrlEPServiceComplete                                                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Function:        void USBPrepareForNextSetupTrf(void)                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Overview:        The routine forces EP0 OUT to be ready for a new Setup       G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                  transaction, and forces EP0 IN to be owned by CPU.           G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           void USBPrepareForNextSetupTrf(void)                                             G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003fa   6a00     CLRF      0x0,0x0            ctrl_trf_state = WAIT_SETUP;            // See usbctrltrf.h                  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
0003fc   d80a     RCALL     0x412              ep0Bo.Cnt = EP0_BUFF_SIZE;              // Defined in usbcfg.h               G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000412   0104     MOVLB     0x4                                                                                             
000414   0e08     MOVLW     0x8                                                                                             
000416   6f01     MOVWF     0x1,0x1                                                                                         
000418   0e10     MOVLW     0x10               ep0Bo.ADR = (byte*)&SetupPkt;                                                G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
00041a   6f02     MOVWF     0x2,0x1                                                                                         
00041c   0e04     MOVLW     0x4                                                                                             
00041e   6f03     MOVWF     0x3,0x1                                                                                         
000420   0012     RETURN    0x0                                                                                             
0003fe   0e88     MOVLW     0x88               ep0Bo.Stat._byte = _USIE|_DAT0|_DTSEN;  // EP0 buff dsc init, see usbmmap.h  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000400   6f00     MOVWF     0x0,0x1                                                                                         
000402   0104     MOVLB     0x4                ep0Bi.Stat._byte = _UCPU;               // EP0 IN buffer initialization      G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
000404   6b04     CLRF      0x4,0x1                                                                                         
000406   0012     RETURN    0x0            }//end USBPrepareForNextSetupTrf                                                 G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /** EOF usbctrltrf.c *********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbctrltrf.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                Microchip USB Bootloader Version 1.0                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * FileName:        usbdrv.c                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Author               Date        Comment                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Rawin Rojvanit       11/19/04     Original.                                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * -usbdrv.c-                                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * This file contains functions that check the hardware interrupts for           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * USB events. The main function, USBDriverService(), should be called once      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * every main loop.                                                              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * This is a mini-version of the actual usbdrv.c from the Microchip USB          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Library. Many functions were removed to make the whole bootload application   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * fit under 2KB, which is the size of the boot block.                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /** I N C L U D E S **********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #include <p18cxxx.h>                                                             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #include "io_cfg.h"             // Required for USBCheckBusStatus()              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /** V A R I A B L E S ********************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #pragma udata                                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /** P R I V A T E  P R O T O T Y P E S ***************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBModuleEnable(void);                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBModuleDisable(void);                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBSuspend(void);                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBWakeFromSuspend(void);                                                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBProtocolResetHandler(void);                                              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USB_SOF_Handler(void);                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBStallHandler(void);                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBErrorHandler(void);                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /** D E C L A R A T I O N S **************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Function:        void USBCheckBusStatus(void)                                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Overview:        This routine enables/disables the USB module by monitoring   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  the USB power signal.                                        G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBCheckBusStatus(void)                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
0004f4   0e08     MOVLW     0x8                UCON = 0b00001000;              // Enable USBEN only                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
0004f6   6e6d     MOVWF     0x6d,0x0                                                                                        
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * After enabling the USB module, it takes some time for the voltage         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * on the D+ or D- line to rise high enough to get out of the SE0 condition. G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * The USB Reset interrupt should not be unmasked until the SE0 condition is G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * cleared. This helps preventing the firmware from misinterpreting this     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * unique event as a USB bus reset from the USB host.                        G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
0004f8   ba6d     BTFSC     0x6d,0x5,0x0       while(UCONbits.SE0);            // Blocking loop                             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
0004fa   d7fe     BRA       0x4f8                                                                                           
0004fc   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clear all USB interrupts                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
0004fe   0e11     MOVLW     0x11               UIE = 0b00010001;               // Unmask RESET & IDLE interrupts only       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000500   6e69     MOVWF     0x69,0x0                                                                                        
000502   0e02     MOVLW     0x2                usb_device_state = POWERED_STATE;                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000504   6e0d     MOVWF     0xd,0x0                                                                                         
000506   0012     RETURN    0x0            }//end USBCheckBusStatus                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Function:        void USBDriverService(void)                                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * PreCondition:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Side Effects:    None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Overview:        This routine is the heart of this firmware. It manages       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  all USB interrupts.                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Note:            Device state transitions through the following stages:       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  DETACHED -> ATTACHED -> POWERED -> DEFAULT ->                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  ADDRESS_PENDING -> ADDRESSED -> CONFIGURED -> READY          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBDriverService(void)                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Task A: Service USB Activity Interrupt                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000508   5068     MOVF      0x68,0x0,0x0       if(UIRbits.ACTVIF && UIEbits.ACTVIE)                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00050a   0b04     ANDLW     0x4                                                                                             
00050c   e006     BZ        0x51a                                                                                           
00050e   5069     MOVF      0x69,0x0,0x0                                                                                    
000510   0b04     ANDLW     0x4                                                                                             
000512   e003     BZ        0x51a                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000514   926d     BCF       0x6d,0x1,0x0           UCONbits.SUSPND = 0;                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000516   9469     BCF       0x69,0x2,0x0           UIEbits.ACTVIE = 0;                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000518   9468     BCF       0x68,0x2,0x0           UIRbits.ACTVIF = 0;                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               }//end if                                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Task B: Service USB Bus Reset Interrupt.                                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * When bus reset is received during suspend, ACTVIF will be set first,      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * once the UCONbits.SUSPND is clear, then the URSTIF bit will be asserted.  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * This is why URSTIF is checked after ACTVIF.                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                *                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * The USB reset flag is masked when the USB state is in                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * DETACHED_STATE or ATTACHED_STATE, and therefore cannot                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * cause a USB reset event during these two states.                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00051a   5068     MOVF      0x68,0x0,0x0       if(UIRbits.URSTIF && UIEbits.URSTIE)    USBProtocolResetHandler();           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00051c   0b01     ANDLW     0x1                                                                                             
00051e   e004     BZ        0x528                                                                                           
000520   5069     MOVF      0x69,0x0,0x0                                                                                    
000522   0b01     ANDLW     0x1                                                                                             
000524   e001     BZ        0x528                                                                                           
000526   d826     RCALL     0x574                                                                                           
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Task C: Service other USB interrupts                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000528   5068     MOVF      0x68,0x0,0x0       if(UIRbits.IDLEIF && UIEbits.IDLEIE)                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00052a   0b10     ANDLW     0x10                                                                                            
00052c   e009     BZ        0x540                                                                                           
00052e   5069     MOVF      0x69,0x0,0x0                                                                                    
000530   0b10     ANDLW     0x10                                                                                            
000532   e006     BZ        0x540                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000534   8469     BSF       0x69,0x2,0x0           UIEbits.ACTVIE = 1;                     // Enable bus activity interrupt G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000536   9868     BCF       0x68,0x4,0x0           UIRbits.IDLEIF = 0;                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000538   826d     BSF       0x6d,0x1,0x0           UCONbits.SUSPND = 1;                    // Put USB module in power conserve G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                           // mode, SIE clock inactive      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                   /* Now, go into power saving */                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00053a   8aa0     BSF       0xa0,0x5,0x0           PIE2bits.USBIE = 1;                     // Set wakeup source             G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00053c   0003     SLEEP                            Sleep();                                                                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00053e   9aa1     BCF       0xa1,0x5,0x0           PIR2bits.USBIF = 0;                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               }//end if                                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000540   5068     MOVF      0x68,0x0,0x0       if(UIRbits.STALLIF && UIEbits.STALLIE)                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000542   0b20     ANDLW     0x20                                                                                            
000544   e009     BZ        0x558                                                                                           
000546   5069     MOVF      0x69,0x0,0x0                                                                                    
000548   0b20     ANDLW     0x20                                                                                            
00054a   e006     BZ        0x558                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00054c   a070     BTFSS     0x70,0x0,0x0           if(UEP0bits.EPSTALL == 1)                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00054e   d003     BRA       0x556                                                                                           
                                                   {                                                                        G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000550   ecfd     CALL      0x3fa,0x0                  USBPrepareForNextSetupTrf();        // Firmware Work-Around          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000552   f001                                                                                                               
000554   9070     BCF       0x70,0x0,0x0               UEP0bits.EPSTALL = 0;                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                   }//end if                                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000556   9a68     BCF       0x68,0x5,0x0           UIRbits.STALLIF = 0;                                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               }//end if                                                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Pointless to continue servicing if the host has not sent a bus reset.     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Once bus reset is received, the device transitions into the DEFAULT       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * state and is ready for communication.                                     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000558   0e03     MOVLW     0x3                if(usb_device_state < DEFAULT_STATE) return;                                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00055a   5c0d     SUBWF     0xd,0x0,0x0                                                                                     
00055c   e201     BC        0x560                                                                                           
00055e   d009     BRA       0x572                                                                                           
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               /*                                                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                * Task D: Servicing USB Transaction Complete Interrupt                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                */                                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000560   5068     MOVF      0x68,0x0,0x0       if(UIRbits.TRNIF && UIEbits.TRNIE)                                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000562   0b08     ANDLW     0x8                                                                                             
000564   e006     BZ        0x572                                                                                           
000566   5069     MOVF      0x69,0x0,0x0                                                                                    
000568   0b08     ANDLW     0x8                                                                                             
00056a   e003     BZ        0x572                                                                                           
                                               {                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                   /*                                                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * USBCtrlEPService only services transactions over EP0.                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * It ignores all other EP transactions.                                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    */                                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00056c   ec2a     CALL      0x254,0x0              USBCtrlEPService();                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00056e   f001                                                                                                               
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                   /*                                                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * Other EP can be serviced later by responsible device class firmware.  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * Each device driver knows when an OUT or IN transaction is ready by    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * checking the buffer ownership bit.                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * An OUT EP should always be owned by SIE until the data is ready.      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * An IN EP should always be owned by CPU until the data is ready.       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    *                                                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * Because of this logic, it is not necessary to save the USTAT value    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    * of non-EP0 transactions.                                              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                    */                                                                      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000570   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                               }//end if(UIRbits.TRNIF && UIEbits.TRNIE)                                    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000572   0012     RETURN    0x0            }//end USBDriverService                                                          G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /******************************************************************************  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Function:        void USBProtocolResetHandler(void)                           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * PreCondition:    A USB bus reset is received from the host.                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Input:           None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Output:          None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Side Effects:    Currently, this routine flushes any pending USB              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  transactions. It empties out the USTAT FIFO. This action     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  might not be desirable in some applications.                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Overview:        Once a USB bus reset is received from the host, this         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  routine should be called. It resets the device address to    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  zero, disables all non-EP0 endpoints, initializes EP0 to     G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  be ready for default communication, clears all USB           G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  interrupt flags, unmasks applicable USB interrupts, and      G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                  reinitializes internal state-machine variables.              G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            * Note:            None                                                         G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                            *****************************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           void USBProtocolResetHandler(void)                                               G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000574   6a68     CLRF      0x68,0x0           UIR = 0;                        // Clears all USB interrupts                 G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000576   0e7b     MOVLW     0x7b               UIE = 0b01111011;               // Enable all interrupts except ACTVIE       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000578   6e69     MOVWF     0x69,0x0                                                                                        
00057a   6a6e     CLRF      0x6e,0x0           UADDR = 0x00;                   // Reset to default address                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00057c   0e16     MOVLW     0x16               UEP0 = EP_CTRL|HSHK_EN;         // Init EP0 as a Ctrl EP, see usbdrv.h       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00057e   6e70     MOVWF     0x70,0x0                                                                                        
000580   a668     BTFSS     0x68,0x3,0x0       while(UIRbits.TRNIF == 1)       // Flush any pending transactions            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000582   d002     BRA       0x588                                                                                           
000586   d7fc     BRA       0x580                                                                                           
000584   9668     BCF       0x68,0x3,0x0           UIRbits.TRNIF = 0;                                                       G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000588   986d     BCF       0x6d,0x4,0x0       UCONbits.PKTDIS = 0;            // Make sure packet processing is enabled    G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00058a   ecfd     CALL      0x3fa,0x0          USBPrepareForNextSetupTrf();    // Declared in usbctrltrf.c                  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
00058c   f001                                                                                                               
00058e   6a0f     CLRF      0xf,0x0            usb_active_cfg = 0;             // Clear active configuration                G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000590   0e03     MOVLW     0x3                usb_device_state = DEFAULT_STATE;                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
000592   6e0d     MOVWF     0xd,0x0                                                                                         
000594   0012     RETURN    0x0            }//end USBProtocolResetHandler                                                   G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /** EOF usbdrv.c *************************************************************/  G:\USBPICPROG-SVN\Boot\sys\usbdrv.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                Microchip USB C18 Firmware Version 1.0                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *********************************************************************           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * FileName:        usbdsc.c                                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Dependencies:    See INCLUDES section below                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Processor:       PIC18                                                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Compiler:        C18 2.30.01+                                                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Company:         Microchip Technology, Inc.                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Software License Agreement                                                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The software supplied herewith by Microchip Technology Incorporated           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * (the “Company”) for its PICmicro® Microcontroller is intended and             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * supplied to you, the Company’s customer, for use solely and                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * exclusively on Microchip PICmicro Microcontroller products. The               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * software is owned by the Company and/or its supplier, and is                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * protected under applicable copyright laws. All rights are reserved.           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Any use in violation of the foregoing restrictions may subject the            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * user to criminal sanctions under applicable laws, as well as to               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * civil liability for the breach of the terms and conditions of this            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * license.                                                                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * THIS SOFTWARE IS PROVIDED IN AN “AS IS” CONDITION. NO WARRANTIES,             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.                             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -usbdsc.c-                                                                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * This file contains the USB descriptor information. It is used                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * in conjunction with the usbdsc.h file. When a descriptor is added             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * or removed from the main configuration descriptor, i.e. CFG01,                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * the user must also change the descriptor structure defined in                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * the usbdsc.h file. The structure is used to calculate the                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * descriptor size, i.e. sizeof(CFG01).                                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * A typical configuration descriptor consists of:                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * At least one configuration descriptor (USB_CFG_DSC)                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * One or more interface descriptors (USB_INTF_DSC)                              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * One or more endpoint descriptors (USB_EP_DSC)                                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Naming Convention:                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * To resolve ambiguity, the naming convention are as followed:                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * - USB_CFG_DSC type should be named cdxx, where xx is the                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   configuration number. This number should match the actual                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   index value of this configuration.                                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * - USB_INTF_DSC type should be named i<yy>a<zz>, where yy is the               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   interface number and zz is the alternate interface number.                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * - USB_EP_DSC type should be named ep<##><d>_i<yy>a<zz>, where                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   ## is the endpoint number and d is the direction of transfer.               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   The interface name should also be listed as a suffix to identify            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *   which interface does the endpoint belong to.                                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Example:                                                                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * If a device has one configuration, two interfaces; interface 0                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * has two endpoints (in and out), and interface 1 has one endpoint(in).         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Then the CFG01 structure in the usbdsc.h should be:                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * #define CFG01 rom struct                            \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * {   USB_CFG_DSC             cd01;                   \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *     USB_INTF_DSC            i00a00;                 \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *     USB_EP_DSC              ep01o_i00a00;           \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *     USB_EP_DSC              ep01i_i00a00;           \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *     USB_INTF_DSC            i01a00;                 \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *     USB_EP_DSC              ep02i_i01a00;           \                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * } cfg01                                                                       G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Note the hierarchy of the descriptors above, it follows the USB               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * specification requirement. All endpoints belonging to an interface            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * should be listed immediately after that interface.                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -------------------------------------------------------------------           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Filling in the descriptor values in the usbdsc.c file:                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -------------------------------------------------------------------           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Most items should be self-explanatory, however, a few will be                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * explained for clarification.                                                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * [Configuration Descriptor(USB_CFG_DSC)]                                       G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The configuration attribute must always have the _DEFAULT                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * definition at the minimum. Additional options can be ORed                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * to the _DEFAULT attribute. Available options are _SELF and _RWU.              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * These definitions are defined in the usbdefs_std_dsc.h file. The              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * _SELF tells the USB host that this device is self-powered. The                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * _RWU tells the USB host that this device supports Remote Wakeup.              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * [Endpoint Descriptor(USB_EP_DSC)]                                             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Assume the following example:                                                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,64,0x00                             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The first two parameters are self-explanatory. They specify the               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * length of this endpoint descriptor (7) and the descriptor type.               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The next parameter identifies the endpoint, the definitions are               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * defined in usbdefs_std_dsc.h and has the following naming                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * convention:                                                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * _EP<##>_<dir>                                                                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * where ## is the endpoint number and dir is the direction of                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * transfer. The dir has the value of either 'OUT' or 'IN'.                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The next parameter identifies the type of the endpoint. Available             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * options are _BULK, _INT, _ISO, and _CTRL. The _CTRL is not                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * typically used because the default control transfer endpoint is               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * not defined in the USB descriptors. When _ISO option is used,                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * addition options can be ORed to _ISO. Example:                                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * _ISO|_AD|_FE                                                                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * This describes the endpoint as an isochronous pipe with adaptive              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * and feedback attributes. See usbdefs_std_dsc.h and the USB                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * specification for details. The next parameter defines the size of             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * the endpoint. The last parameter in the polling interval.                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -------------------------------------------------------------------           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Adding a USB String                                                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -------------------------------------------------------------------           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * A string descriptor array should have the following format:                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[size];}sdxxx={              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * sizeof(sdxxx),DSC_STR,<text>};                                                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The above structure provides a means for the C compiler to                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * calculate the length of string descriptor sdxxx, where xxx is the             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * index number. The first two bytes of the descriptor are descriptor            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * length and type. The rest <text> are string texts which must be               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * in the unicode format. The unicode format is achieved by declaring            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * each character as a word type. The whole text string is declared              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * as a word array with the number of characters equals to <size>.               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * <size> has to be manually counted and entered into the array                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * declaration. Let's study this through an example:                             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * if the string is "USB" , then the string descriptor should be:                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * (Using index 02)                                                              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * rom struct{byte bLength;byte bDscType;word string[3];}sd002={                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * sizeof(sd002),DSC_STR,'U','S','B'};                                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * A USB project may have multiple strings and the firmware supports             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * the management of multiple strings through a look-up table.                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The look-up table is defined as:                                              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * rom const unsigned char *rom USB_SD_Ptr[]={&sd000,&sd001,&sd002};             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The above declaration has 3 strings, sd000, sd001, and sd002.                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Strings can be removed or added. sd000 is a specialized string                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * descriptor. It defines the language code, usually this is                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * US English (0x0409). The index of the string must match the index             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * position of the USB_SD_Ptr array, &sd000 must be in position                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * USB_SD_Ptr[0], &sd001 must be in position USB_SD_Ptr[1] and so on.            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The look-up table USB_SD_Ptr is used by the get string handler                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * function in usb9.c.                                                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * -------------------------------------------------------------------           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The look-up table scheme also applies to the configuration                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * descriptor. A USB device may have multiple configuration                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * descriptors, i.e. CFG01, CFG02, etc. To add a configuration                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * descriptor, user must implement a structure similar to CFG01.                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * The next step is to add the configuration descriptor name, i.e.               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * cfg01, cfg02,.., to the look-up table USB_CD_Ptr. USB_CD_Ptr[0]               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * is a dummy place holder since configuration 0 is the un-configured            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * state according to the definition in the USB specification.                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /*********************************************************************           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Descriptor specific type definitions are defined in:                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * system\usb\usbdefs\usbdefs_std_dsc.h                                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            *                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * Configuration information is defined in:                                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            * autofiles\usbcfg.h                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                            ********************************************************************/           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /** I N C L U D E S *************************************************/           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           #include "sys\typedefs.h"                                                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           #include "sys\usb.h"                                                             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /** C O N S T A N T S ************************************************/          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           #pragma romdata                                                                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /* Device Descriptor */                                                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           rom USB_DEV_DSC device_dsc=                                                      G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(USB_DEV_DSC),    // Size of this descriptor in bytes                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               DSC_DEV,                // DEVICE descriptor type                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x0200,                 // USB Spec Release Number in BCD format             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Class Code                                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Subclass code                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Protocol code                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               EP0_BUFF_SIZE,          // Max packet size for EP0, see usbcfg.h             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x04D8,                 // Vendor ID                                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x000b,                 // Product ID: PICDEM FS USB (Boot Mode)             G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x0000,                 // Device release number in BCD format               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Manufacturer string index                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Product string index                              G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Device serial number string index                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x01                    // Number of possible configurations                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           };                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /* Configuration 1 Descriptor */                                                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           CFG01=                                                                           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           {                                                                                G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               /* Configuration Descriptor */                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(USB_CFG_DSC),    // Size of this descriptor in bytes                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               DSC_CFG,                // CONFIGURATION descriptor type                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(cfg01),          // Total length of data for this cfg                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               1,                      // Number of interfaces in this cfg                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               1,                      // Index value of this configuration                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0,                      // Configuration string index                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               _DEFAULT,               // Attributes, see usbdefs_std_dsc.h                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               50,                     // Max power consumption (2X mA)                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               /* Interface Descriptor */                                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(USB_INTF_DSC),   // Size of this descriptor in bytes                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               DSC_INTF,               // INTERFACE descriptor type                         G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0,                      // Interface Number                                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0,                      // Alternate Setting Number                          G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               2,                      // Number of endpoints in this intf                  G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Class code                                        G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Subclass code                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0x00,                   // Protocol code                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               0,                      // Interface string index                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               /* Endpoint Descriptors */                                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP01_OUT,_BULK,BOOT_EP_SIZE,0x00,                 G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                               sizeof(USB_EP_DSC),DSC_EP,_EP01_IN,_BULK,BOOT_EP_SIZE,0x00                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           };                                                                               G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           rom struct{byte bLength;byte bDscType;word string[1];}sd000={                    G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           sizeof(sd000),DSC_STR,0x0409};                                                   G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           #pragma code                                                                     G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                                                                                            G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                           /** EOF usbdsc.c ****************************************************/           G:\USBPICPROG-SVN\Boot\usb\usbdsc.c
                                                   LIST P=18F2550                                                           C:\MCC18\SRC\TRADIT~1\PROC\p18f2550.asm
                                                   LIST                                                                     C:\MCC18\SRC\TRADIT~1\PROC\p18f2550.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\PROC\p18f2550.asm
                                           ;	RCS Header $Id: cmath18.asm,v 1.4.12.1 2006/01/13 04:11:25 nairnj Exp $        C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;       CMATH18 DATA DEFINITION FILE                                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;   VARIABLE ALLOCATION - Core math library routines                             C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           ;******************************************************************************* C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           MATH_DATA      UDATA_ACS                                                         C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           SIGN		RES 1       ; save location for sign in MSB                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           __FPFLAGSbits                                                                    C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           __FPFLAGS		RES 1       ; floating point library exception flags                  C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                                                                                            C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   GLOBAL  SIGN, __FPFLAGS, __FPFLAGSbits                                   C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                           	                                                                                C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
                                                   END                                                                      C:\MCC18\SRC\TRADIT~1\MATH\cmath18.asm
